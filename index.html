<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¥¬ ì¬ë£Œ ë¸”ë¡œê·¸ ìë™ ìƒì„±ê¸° (Gemini)</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root{--ink:#1a1a2e;--paper:#faf8f3;--paper2:#f0ede4;--accent:#2e7d32;--accent2:#ef6c00;--accent-light:#e8f5e9;--border:#d8d0c0;--muted:#8b7d6b;--danger:#c62828;--blue:#1565c0}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Noto Sans KR',sans-serif;background:var(--paper);color:var(--ink);min-height:100vh}
.header{background:var(--ink);padding:14px 24px;display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:200;box-shadow:0 2px 8px rgba(0,0,0,0.25)}
.header-logo{font-family:'Noto Serif KR',serif;font-size:18px;color:#fff;font-weight:700}
.header-logo span{color:#a5d6a7}
.header-sub{font-size:11px;color:#666;margin-left:auto}
.app{display:grid;grid-template-columns:272px 1fr;min-height:calc(100vh - 52px)}
.sidebar{background:var(--paper2);border-right:1px solid var(--border);padding:16px 10px;display:flex;flex-direction:column;gap:5px;overflow-y:auto;max-height:calc(100vh - 52px);position:sticky;top:52px}
.sidebar-title{font-size:9.5px;font-weight:700;color:var(--muted);letter-spacing:1px;text-transform:uppercase;padding:0 8px 7px;border-bottom:1px solid var(--border);margin-bottom:3px}
.step-btn{display:flex;align-items:center;gap:9px;padding:8px 9px;border-radius:7px;border:none;background:transparent;cursor:pointer;text-align:left;width:100%;transition:all .15s;font-family:'Noto Sans KR',sans-serif}
.step-btn:hover{background:#e8e3d8}
.step-btn.active{background:var(--accent);color:white}
.step-btn.active .step-num,.step-btn.active .step-sublabel{color:rgba(255,255,255,0.8)}
.step-btn.active .step-num{background:rgba(255,255,255,0.2)}
.step-btn.done .step-num{background:var(--accent);color:white}
.step-num{width:22px;height:22px;border-radius:50%;background:var(--border);display:flex;align-items:center;justify-content:center;font-size:9.5px;font-weight:700;flex-shrink:0;color:var(--muted)}
.step-label{font-size:12px;font-weight:500;line-height:1.3}
.step-sublabel{font-size:9.5px;color:var(--muted);margin-top:1px}
.main{padding:24px 28px;overflow-y:auto;max-height:calc(100vh - 52px)}
.panel{display:none}.panel.active{display:block}
.panel-title{font-family:'Noto Serif KR',serif;font-size:22px;font-weight:700;margin-bottom:5px}
.panel-desc{font-size:12.5px;color:var(--muted);line-height:1.6;margin-bottom:20px}
.config-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:18px}
.field{display:flex;flex-direction:column;gap:5px}
.field.full{grid-column:1/-1}
label{font-size:12px;font-weight:600;color:var(--ink)}
label .req{color:var(--accent)}
input[type=text],input[type=password],textarea,select{width:100%;padding:8px 12px;border:1.5px solid var(--border);border-radius:7px;font-family:'Noto Sans KR',sans-serif;font-size:13px;background:white;color:var(--ink);outline:none;transition:border-color .2s}
input:focus,textarea:focus,select:focus{border-color:var(--accent)}
textarea{resize:vertical;min-height:160px;font-size:12px;line-height:1.6}
.color-options{display:grid;grid-template-columns:repeat(5,1fr);gap:7px}
.color-opt{border:2px solid var(--border);border-radius:9px;padding:8px 3px;cursor:pointer;text-align:center;transition:all .15s;background:white}
.color-opt:hover{border-color:#999}
.color-opt.selected{border-color:var(--ink);box-shadow:0 0 0 2px var(--ink)}
.color-swatch{width:28px;height:28px;border-radius:50%;margin:0 auto 5px;font-size:12px;display:flex;align-items:center;justify-content:center}
.color-name{font-size:9px;color:var(--muted);line-height:1.3}
.info-banner{background:#e8f5e9;border:1px solid #a5d6a7;border-radius:9px;padding:12px 16px;margin-bottom:18px}
.info-banner h3{font-size:12px;font-weight:700;color:#1b5e20;margin-bottom:6px}
.info-banner p{font-size:11px;color:#2e7d32;line-height:1.5}
.btn{display:inline-flex;align-items:center;gap:5px;padding:8px 18px;border-radius:7px;border:none;font-family:'Noto Sans KR',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .15s;white-space:nowrap}
.btn-primary{background:var(--accent);color:white}.btn-primary:hover{background:#1b5e20}.btn-primary:disabled{background:#aaa;cursor:not-allowed}
.btn-secondary{background:white;color:var(--ink);border:1.5px solid var(--border)}.btn-secondary:hover{background:var(--paper2)}
.btn-orange{background:var(--accent2);color:white}.btn-orange:hover{background:#e65100}
.btn-blue{background:var(--blue);color:white}.btn-blue:hover{background:#0d47a1}
.btn-danger{background:var(--danger);color:white}.btn-danger:hover{background:#b71c1c}
.btn-sm{padding:5px 12px;font-size:11.5px;border-radius:6px}
.btn-lg{padding:11px 26px;font-size:14px}
.step-info-bar{background:var(--accent-light);border:1px solid #c8e6c9;border-radius:8px;padding:10px 14px;margin-bottom:16px;font-size:12px;color:#2e7d32;line-height:1.6;display:none}
.generate-area{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;align-items:center}
.progress-wrap{height:3px;background:var(--border);border-radius:2px;margin-bottom:16px;overflow:hidden}
.progress-bar{height:100%;background:var(--accent);border-radius:2px;transition:width .4s}
.toolbar{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;padding:10px 12px;background:white;border:1.5px solid var(--border);border-radius:9px;align-items:center}
.toolbar-label{font-size:10.5px;font-weight:700;color:var(--muted);margin-right:4px}
.toolbar-sep{width:1px;height:22px;background:var(--border);margin:0 4px}
.result-box{border:1.5px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:14px}
.result-header{background:var(--paper2);padding:9px 14px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:6px}
.result-title{font-size:11.5px;font-weight:700;color:var(--muted)}
.result-tabs{display:flex;gap:3px}
.tab-btn{padding:3px 9px;border-radius:5px;border:1px solid var(--border);background:white;font-size:10.5px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:all .1s}
.tab-btn.active{background:var(--accent);color:white;border-color:var(--accent)}
.result-content{background:white;min-height:100px;max-height:560px;overflow-y:auto}
.preview-frame{width:100%;min-height:380px;border:none;display:block}
.code-view{padding:12px;font-size:11px;font-family:'Courier New',monospace;white-space:pre-wrap;overflow-x:auto;line-height:1.55;color:#333;background:#fafafa}
.loading{display:flex;align-items:center;gap:10px;padding:20px 14px;color:var(--muted);font-size:12.5px}
.spinner{width:17px;height:17px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;flex-shrink:0}
@keyframes spin{to{transform:rotate(360deg)}}
.alert{padding:10px 13px;border-radius:7px;font-size:12px;margin-bottom:12px;line-height:1.5}
.alert-warn{background:#fff8e1;border-left:3px solid #f9a825;color:#6d4c00}
.alert-success{background:#e8f5e9;border-left:3px solid #2e7d32;color:#1b5e20}
.alert-error{background:#ffebee;border-left:3px solid #c62828;color:#7f0000}
.alert-blue{background:#e3f2fd;border-left:3px solid #1565c0;color:#0d47a1}
.compile-grid{display:grid;gap:7px;margin-bottom:18px}
.compile-item{background:white;border:1.5px solid var(--border);border-radius:7px;padding:9px 13px;display:flex;align-items:center;justify-content:space-between}
.compile-item.done{border-color:#c8e6c9;background:#f9fff9}
.compile-item.missing{border-color:#ffcdd2;background:#fff9f9}
.compile-label{font-size:12px;font-weight:500}
.compile-status{font-size:10.5px;padding:2px 8px;border-radius:20px;font-weight:600}
.compile-item.done .compile-status{background:#c8e6c9;color:#1b5e20}
.compile-item.missing .compile-status{background:#ffcdd2;color:#b71c1c}
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:500;align-items:center;justify-content:center}
.modal-overlay.open{display:flex}
.modal{background:white;border-radius:14px;padding:24px;width:92%;max-width:680px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.2);position:relative}
.modal-title{font-family:'Noto Serif KR',serif;font-size:18px;font-weight:700;margin-bottom:6px}
.modal-desc{font-size:12px;color:var(--muted);margin-bottom:18px;line-height:1.5}
.modal-close{position:absolute;top:14px;right:16px;background:none;border:none;font-size:20px;cursor:pointer;color:#999;padding:2px 6px;border-radius:4px}
.modal-close:hover{background:var(--paper2)}
.modal-actions{display:flex;gap:8px;margin-top:18px;justify-content:flex-end;flex-wrap:wrap}
.edit-textarea{width:100%;min-height:300px;font-size:11.5px;font-family:'Courier New',monospace;line-height:1.5;border:1.5px solid var(--border);border-radius:8px;padding:12px;resize:vertical;color:#333}
.edit-textarea:focus{border-color:var(--accent);outline:none}
.img-drop{border:2px dashed var(--border);border-radius:10px;padding:30px;text-align:center;cursor:pointer;transition:all .2s;background:#fafafa;margin-bottom:14px}
.img-drop:hover,.img-drop.drag-over{border-color:var(--accent);background:var(--accent-light)}
.img-drop input{display:none}
.img-drop-icon{font-size:32px;margin-bottom:8px}
.img-drop-text{font-size:12.5px;color:var(--muted)}
.img-preview{max-width:100%;max-height:200px;border-radius:8px;margin-bottom:12px;display:none}
.img-options{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.pos-opt{border:1.5px solid var(--border);border-radius:8px;padding:8px;cursor:pointer;text-align:center;font-size:11.5px;background:white;transition:all .15s}
.pos-opt:hover{border-color:var(--accent)}
.pos-opt.selected{border-color:var(--accent);background:var(--accent-light);color:var(--accent);font-weight:600}
.link-preview{background:var(--paper2);border-radius:8px;padding:10px 13px;font-size:11.5px;color:var(--muted);margin-top:10px;border:1px solid var(--border);word-break:break-all;display:none}
.ask-result{background:#f9f9f9;border:1px solid var(--border);border-radius:8px;padding:12px;margin-top:12px;font-size:12px;line-height:1.6;max-height:300px;overflow-y:auto;display:none;white-space:pre-wrap}
.tag-row{display:flex;flex-wrap:wrap;gap:5px;margin-top:8px}
.tag{background:var(--accent-light);color:var(--accent);font-size:10.5px;padding:2px 8px;border-radius:20px;font-weight:600;cursor:pointer;border:1px solid #c8e6c9}
.tag:hover{background:var(--accent);color:white}
.form-row{display:flex;flex-direction:column;gap:5px;margin-bottom:13px}
.form-row label{font-size:12px;font-weight:600}
.form-note{font-size:10.5px;color:var(--muted);margin-top:3px}
.pos-list-item:hover{background:var(--accent-light)!important;color:var(--accent)!important}
.pos-list-item:last-child{border-bottom:none!important}
.toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%) translateY(60px);background:var(--ink);color:white;padding:9px 20px;border-radius:30px;font-size:12.5px;font-weight:500;z-index:999;opacity:0;transition:all .3s;pointer-events:none}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* ============================================================
   MOBILE RESPONSIVE
   ============================================================ */
/* ëª¨ë°”ì¼ ì „ìš© ìš”ì†Œ â€” ê¸°ë³¸ ìˆ¨ê¹€ */
.mobile-header-menu{display:none}
.mobile-nav-bar{display:none}
.sidebar-backdrop{display:none}

@media (max-width: 768px) {
  /* í—¤ë” */
  .header{padding:12px 16px}
  .header-sub{display:none}
  .mobile-header-menu{display:flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:8px;border:none;background:rgba(255,255,255,0.15);color:white;font-size:18px;cursor:pointer;margin-right:4px;flex-shrink:0}

  /* ë ˆì´ì•„ì›ƒ: ì‚¬ì´ë“œë°” ìˆ¨ê¸°ê³  ì „ì²´ ë„ˆë¹„ë¡œ */
  .app{grid-template-columns:1fr;min-height:calc(100vh - 52px)}

  /* ì‚¬ì´ë“œë°”: ë“œë¡œì–´ ë°©ì‹ */
  .sidebar{
    position:fixed;top:52px;left:0;bottom:0;width:272px;z-index:300;
    transform:translateX(-100%);transition:transform .25s ease;
    max-height:calc(100vh - 52px);
    box-shadow:4px 0 20px rgba(0,0,0,0.15);
  }
  .sidebar.open{transform:translateX(0)}

  /* ì‚¬ì´ë“œë°” ì—´ë¦´ ë•Œ ë°°ê²½ ë”¤ì²˜ë¦¬ */
  .sidebar-backdrop{
    display:block;position:fixed;inset:0;background:rgba(0,0,0,0.4);
    z-index:299;opacity:0;pointer-events:none;transition:opacity .25s;
  }
  .sidebar-backdrop.open{opacity:1;pointer-events:all}

  /* ë©”ì¸ ì½˜í…ì¸  */
  .main{
    padding:16px 14px 90px;
    max-height:none;
    overflow-y:visible;
  }

  /* íŒ¨ë„ íƒ€ì´í‹€ */
  .panel-title{font-size:18px}

  /* config ê·¸ë¦¬ë“œ 1ì—´ */
  .config-grid{grid-template-columns:1fr}
  .field.full{grid-column:1}

  /* ì»¬ëŸ¬ ì˜µì…˜ 3ì—´ */
  .color-options{grid-template-columns:repeat(3,1fr)}

  /* ë²„íŠ¼ */
  .btn-lg{padding:11px 20px;font-size:13px;width:100%;justify-content:center}
  .generate-area{flex-direction:column;align-items:stretch}
  .generate-area .btn{width:100%;justify-content:center}

  /* íˆ´ë°” ë²„íŠ¼ ì‘ê²Œ */
  .toolbar{gap:4px;padding:8px 10px}
  .toolbar-sep{display:none}

  /* ê²°ê³¼ íƒ­ */
  .result-tabs{flex-wrap:wrap;gap:3px}

  /* ëª¨ë‹¬ */
  .modal{padding:16px;border-radius:10px 10px 0 0;position:fixed;bottom:0;left:0;right:0;width:100%;max-width:100%;max-height:88vh;margin:0}
  .modal-overlay{align-items:flex-end}

  /* ì´ë¯¸ì§€ ëª¨ë‹¬ ê·¸ë¦¬ë“œ 1ì—´ */
  .modal .img-options,
  .modal [style*="grid-template-columns:1fr 1fr"]{grid-template-columns:1fr!important}

  /* compile ì²´í¬ë¦¬ìŠ¤íŠ¸ */
  .compile-item{flex-wrap:wrap;gap:4px}

  /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” */
  .mobile-nav-bar{
    display:flex;position:fixed;bottom:0;left:0;right:0;
    background:white;border-top:1px solid var(--border);
    z-index:200;height:60px;
    box-shadow:0 -2px 12px rgba(0,0,0,0.1);
  }
  .mobile-nav-item{
    flex:1;display:flex;flex-direction:column;align-items:center;
    justify-content:center;gap:2px;border:none;background:transparent;
    cursor:pointer;font-family:'Noto Sans KR',sans-serif;
    color:var(--muted);font-size:9px;font-weight:500;padding:4px 2px;
    transition:color .15s;
  }
  .mobile-nav-item.active{color:var(--accent)}
  .mobile-nav-item .nav-icon{font-size:18px;line-height:1}
  .mobile-nav-item .nav-label{font-size:9px;line-height:1}

  /* iframe ë†’ì´ ì¤„ì„ */
  .preview-frame{min-height:260px}
  iframe.preview-frame[style*="height:460px"]{height:320px!important}
  iframe.preview-frame[style*="height:680px"]{height:420px!important}
  iframe[style*="height:380px"]{height:280px!important}

  /* ë¶€ê°€ì •ë³´ ë³¸ë¬¸ */
  #extra-info-body{padding:14px;font-size:12px}
}
</style>
</head>
<body>

<div class="toast" id="toast"></div>

<!-- EDIT MODAL -->
<div class="modal-overlay" id="modal-edit">
  <div class="modal" style="max-width:900px;width:96%">
    <button class="modal-close" onclick="closeModal('edit')">âœ•</button>
    <div class="modal-title">âœï¸ ì„¹ì…˜ HTML ì§ì ‘ ìˆ˜ì •</div>
    <div class="modal-desc">HTMLì„ ì§ì ‘ í¸ì§‘í•˜ê±°ë‚˜, ë‹¤ë¥¸ ê³³ì—ì„œ ê°€ì ¸ì˜¨ ì°¸ê³  ê¸€ì„ ë¶™ì—¬ë„£ì–´ AIê°€ ì„¹ì…˜ì„ ë‹¤ì‹œ ì‘ì„±í•˜ê²Œ í•  ìˆ˜ ìˆì–´ìš”.</div>

    <!-- í¸ì§‘ + ë¯¸ë¦¬ë³´ê¸° íƒ­ -->
    <div style="display:flex;gap:0;border:1.5px solid var(--border);border-radius:8px;overflow:hidden;margin-bottom:10px;width:fit-content">
      <button id="edit-tab-code-btn" onclick="switchEditTab('code')" style="padding:6px 16px;border:none;background:#e8f5e9;font-family:'Noto Sans KR',sans-serif;font-size:12px;font-weight:700;cursor:pointer;color:#2e7d32;transition:.15s">ğŸ“ HTML í¸ì§‘</button>
      <button id="edit-tab-preview-btn" onclick="switchEditTab('preview')" style="padding:6px 16px;border:none;background:white;font-family:'Noto Sans KR',sans-serif;font-size:12px;font-weight:600;cursor:pointer;color:var(--muted);border-left:1px solid var(--border);transition:.15s">ğŸ‘ ë¯¸ë¦¬ë³´ê¸°</button>
    </div>

    <div id="edit-tab-code" style="display:block">
      <div class="form-row" style="margin-bottom:8px">
        <textarea class="edit-textarea" id="edit-textarea" oninput="scheduleEditPreview()" style="min-height:260px"></textarea>
      </div>
    </div>
    <div id="edit-tab-preview" style="display:none;border:1.5px solid var(--border);border-radius:8px;overflow:hidden;margin-bottom:10px">
      <iframe id="edit-preview-iframe" style="width:100%;height:380px;border:none;display:block;background:white"></iframe>
    </div>

    <!-- AI ì°¸ê³  ê¸€ ê¸°ë°˜ ìˆ˜ì • -->
    <div style="border:1.5px solid #b3d4f5;border-radius:10px;padding:14px 16px;background:#f0f7ff;margin-bottom:4px">
      <div style="font-size:13px;font-weight:700;color:#1565c0;margin-bottom:4px">ğŸ¤– ì°¸ê³  ê¸€ë¡œ AI ì¬ì‘ì„±</div>
      <div style="font-size:11.5px;color:#1976d2;margin-bottom:10px;line-height:1.5">ë‹¤ë¥¸ ê³³(ë¸”ë¡œê·¸, ë…¼ë¬¸, ê¸°ì‚¬ ë“±)ì—ì„œ ë³µì‚¬í•œ ê¸€ì„ ì•„ë˜ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.<br>AIê°€ ê·¸ ë‚´ìš©ì„ ì°¸ê³ í•´ í˜„ì¬ ì„¹ì…˜ì„ ë” ì •í™•í•˜ê³  í’ë¶€í•˜ê²Œ ì¬ì‘ì„±í•´ë“œë ¤ìš”.</div>
      <div class="form-row" style="margin-bottom:8px">
        <label style="color:#1565c0">ğŸ“‹ ì°¸ê³  ê¸€ ë¶™ì—¬ë„£ê¸°</label>
        <textarea id="edit-ref-text" style="min-height:100px;font-size:12px;line-height:1.6;border:1.5px solid #b3d4f5;border-radius:7px;padding:10px;resize:vertical;font-family:'Noto Sans KR',sans-serif;background:white" placeholder="ì—¬ê¸°ì— ì°¸ê³ í•  ê¸€ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. (ë¸”ë¡œê·¸, ë‰´ìŠ¤, ë…¼ë¬¸ ë‚´ìš© ë“± ë¬´ì—‡ì´ë“  OK)&#10;&#10;ì˜ˆ) ì—¬ì£¼ëŠ” í˜ˆë‹¹ ì¡°ì ˆì— íš¨ê³¼ì ì¸ ì„±ë¶„ì¸ ì¹´ë€í‹´ì„ í•¨ìœ í•˜ê³  ìˆìœ¼ë©°..."></textarea>
      </div>
      <div class="form-row" style="margin-bottom:8px">
        <label style="color:#1565c0">âœï¸ ì¶”ê°€ ì§€ì‹œ ì‚¬í•­ (ì„ íƒ)</label>
        <input type="text" id="edit-ask-input" placeholder="ì˜ˆ) ì´ ë‚´ìš©ì„ ë°˜ì˜í•´ì„œ íš¨ëŠ¥ ë¶€ë¶„ì„ ë” êµ¬ì²´ì ìœ¼ë¡œ ë³´ì™„í•´ì£¼ì„¸ìš”" style="border-color:#b3d4f5" />
      </div>
      <button class="btn btn-blue btn-sm" id="edit-ask-btn" onclick="askAIEdit()">ğŸ¤– AIë¡œ ì¬ì‘ì„±í•˜ê¸°</button>
      <div class="loading" id="edit-loading" style="display:none;padding:8px 0"><div class="spinner"></div> AIê°€ ì°¸ê³  ê¸€ì„ ë°”íƒ•ìœ¼ë¡œ ì¬ì‘ì„±í•˜ê³  ìˆì–´ìš”...</div>
      <div class="ask-result" id="edit-ask-result" style="margin-top:8px"></div>
    </div>

    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeModal('edit')">ì·¨ì†Œ</button>
      <button class="btn btn-orange" id="edit-apply-btn" onclick="applyAIEdit()" style="display:none">âœ… AI ê²°ê³¼ ì ìš©</button>
      <button class="btn btn-primary" onclick="saveEdit()">ğŸ’¾ ì €ì¥ & ë‹«ê¸°</button>
    </div>
  </div>
</div>

<!-- IMAGE MODAL -->
<div class="modal-overlay" id="modal-image">
  <div class="modal" style="max-width:740px">
    <button class="modal-close" onclick="closeModal('image')">âœ•</button>
    <div class="modal-title">ğŸ–¼ï¸ ì´ë¯¸ì§€ ì‚½ì…</div>
    <div class="modal-desc">ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ê±°ë‚˜ URLì„ ì…ë ¥í•˜ê³ , ì„¹ì…˜ ì•ˆì˜ ì›í•˜ëŠ” ìœ„ì¹˜ì— ì‚½ì…í•´ìš”.</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px">
      <div>
        <div class="form-row">
          <label>ì´ë¯¸ì§€ ì†ŒìŠ¤</label>
          <div class="img-drop" id="img-drop" onclick="document.getElementById('img-file').click()" ondragover="imgDragOver(event)" ondrop="imgDrop(event)">
            <input type="file" id="img-file" accept="image/*" onchange="imgFileChange(event)" />
            <div class="img-drop-icon">ğŸ“</div>
            <div class="img-drop-text">í´ë¦­í•˜ê±°ë‚˜ ë“œë˜ê·¸<br><span style="font-size:10px;color:#bbb">JPG PNG GIF WebP</span></div>
          </div>
          <img id="img-preview" class="img-preview" alt="ë¯¸ë¦¬ë³´ê¸°" style="max-height:120px" />
          <div style="display:flex;align-items:center;gap:6px;margin:4px 0 6px">
            <div style="flex:1;height:1px;background:var(--border)"></div>
            <span style="font-size:10px;color:var(--muted)">ë˜ëŠ” URL ì…ë ¥</span>
            <div style="flex:1;height:1px;background:var(--border)"></div>
          </div>
          <input type="text" id="img-url" placeholder="https://example.com/image.jpg" oninput="imgUrlPreview()" />
        </div>
        <div class="form-row"><label>ALT í…ìŠ¤íŠ¸</label><input type="text" id="img-alt" placeholder="ì˜ˆ) ì‹ ì„ í•œ ì›ë¬¼ ì‚¬ì§„" oninput="updateImgInsertPreview()" /></div>
        <div class="form-row"><label>ì´ë¯¸ì§€ ìº¡ì…˜ (ì„ íƒ)</label><input type="text" id="img-caption" placeholder="ì˜ˆ) â–² êµ­ë‚´ ì¬ë°° ì‹ ì„ í•œ ì¬ë£Œ" oninput="updateImgInsertPreview()" /></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <div class="form-row" style="margin-bottom:0"><label>ì •ë ¬</label><select id="img-align" onchange="updateImgInsertPreview()"><option value="center">ê°€ìš´ë°</option><option value="left">ì™¼ìª½</option><option value="right">ì˜¤ë¥¸ìª½</option></select></div>
          <div class="form-row" style="margin-bottom:0"><label>ìµœëŒ€ ë„ˆë¹„</label><select id="img-width" onchange="updateImgInsertPreview()"><option value="100%">100%</option><option value="80%">80%</option><option value="60%">60%</option><option value="400px">400px</option><option value="300px">300px</option></select></div>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <div>
          <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px">ğŸ“ ì‚½ì… ìœ„ì¹˜ ì„ íƒ</label>
          <div id="img-pos-list" style="border:1.5px solid var(--border);border-radius:8px;overflow:hidden;max-height:200px;overflow-y:auto;background:white">
            <div style="padding:16px;text-align:center;color:var(--muted);font-size:12px">ì„¹ì…˜ì„ ì—´ë©´ ìë™ìœ¼ë¡œ ëª©ë¡ì´ ë‚˜íƒ€ë‚˜ìš”</div>
          </div>
        </div>
        <div>
          <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px">ğŸ‘ ì„ íƒ ìœ„ì¹˜ ì»¨í…ìŠ¤íŠ¸</label>
          <div id="img-pos-context" style="border:1.5px solid var(--border);border-radius:8px;padding:10px;background:#fafafa;min-height:72px;max-height:120px;overflow-y:auto;font-size:10.5px;font-family:monospace;color:#555;white-space:pre-wrap;line-height:1.5">ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ìš”ì†Œ ì „í›„ ì½”ë“œê°€ í‘œì‹œë¼ìš”</div>
        </div>
      </div>
    </div>
    <!-- ì‚½ì… ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° -->
    <div style="margin-top:14px">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
        <label style="font-size:12px;font-weight:600">ğŸ‘ ì‚½ì… ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</label>
        <div style="display:flex;gap:3px">
          <button id="img-prev-tab-simple" onclick="switchImgPreviewTab('simple')" style="padding:3px 10px;border-radius:5px;border:1px solid var(--border);background:#2e7d32;color:white;font-size:10.5px;cursor:pointer;font-family:'Noto Sans KR',sans-serif">ğŸ–¼ ì´ë¯¸ì§€ë§Œ</button>
          <button id="img-prev-tab-full" onclick="switchImgPreviewTab('full')" style="padding:3px 10px;border-radius:5px;border:1px solid var(--border);background:white;color:var(--muted);font-size:10.5px;cursor:pointer;font-family:'Noto Sans KR',sans-serif">ğŸ“„ ì„¹ì…˜ ì „ì²´</button>
        </div>
      </div>
      <!-- ì´ë¯¸ì§€ë§Œ ë¯¸ë¦¬ë³´ê¸° -->
      <div id="img-prev-simple" style="border:1.5px solid var(--border);border-radius:8px;background:#fafafa;min-height:80px;display:flex;align-items:center;justify-content:center;padding:16px;overflow:hidden">
        <span style="font-size:11.5px;color:var(--muted)">ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ ë‚˜íƒ€ë‚˜ìš”</span>
      </div>
      <!-- ì„¹ì…˜ ì „ì²´ ë¯¸ë¦¬ë³´ê¸° (iframe) -->
      <div id="img-prev-full" style="display:none;border:1.5px solid var(--border);border-radius:8px;overflow:hidden">
        <div style="background:#f5f5f5;padding:6px 12px;font-size:11px;color:var(--muted);border-bottom:1px solid var(--border)">ì„¹ì…˜ì— ì´ë¯¸ì§€ê°€ ì‚½ì…ëœ ëª¨ìŠµì„ ë¯¸ë¦¬ ë³¼ ìˆ˜ ìˆì–´ìš” (ì‹¤ì œ ì €ì¥ ì „)</div>
        <iframe id="img-section-preview-iframe" style="width:100%;height:380px;border:none;display:block;background:white"></iframe>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeModal('image')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="insertImage()">ğŸ–¼ï¸ ì´ë¯¸ì§€ ì‚½ì…í•˜ê¸°</button>
    </div>
  </div>
</div>

<!-- LINK MODAL -->
<div class="modal-overlay" id="modal-link">
  <div class="modal" style="max-width:680px">
    <button class="modal-close" onclick="closeModal('link')">âœ•</button>
    <div class="modal-title">ğŸ”— ë§í¬ ì‚½ì…</div>
    <div class="modal-desc">ë‹¤ì–‘í•œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ì„ ì„ íƒí•´ì„œ ì›í•˜ëŠ” ìœ„ì¹˜ì— ë§í¬ë¥¼ ì‚½ì…í•´ìš”.</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
      <div>
        <div class="form-row">
          <label>ë§í¬ URL <span class="req">*</span></label>
          <input type="text" id="link-url" placeholder="https://..." oninput="updateLinkPreview()" />
        </div>
        <div class="form-row">
          <label>ë¹ ë¥¸ í…œí”Œë¦¿</label>
          <div class="tag-row" style="margin-top:0">
            <span class="tag" onclick="quickLink('ë†ì´Œì§„í¥ì²­ ì˜ì–‘ ì •ë³´ ë³´ê¸°','https://www.rda.go.kr')">ë†ì´Œì§„í¥ì²­</span>
            <span class="tag" onclick="quickLink('ì‹í’ˆì•ˆì „ë‚˜ë¼ì—ì„œ í™•ì¸í•˜ê¸°','https://www.foodsafetykorea.go.kr')">ì‹í’ˆì•ˆì „ë‚˜ë¼</span>
            <span class="tag" onclick="quickLink('ì¿ íŒ¡ì—ì„œ êµ¬ë§¤í•˜ê¸°','https://www.coupang.com')">ì¿ íŒ¡</span>
            <span class="tag" onclick="quickLink('ë„¤ì´ë²„ì‡¼í•‘ì—ì„œ ë³´ê¸°','https://shopping.naver.com')">ë„¤ì´ë²„ì‡¼í•‘</span>
            <span class="tag" onclick="quickLink('ê´€ë ¨ ë ˆì‹œí”¼ ë” ë³´ê¸°','https://www.10000recipe.com')">ë§Œê°œì˜ë ˆì‹œí”¼</span>
            <span class="tag" onclick="quickLink('ìœ íŠœë¸Œì—ì„œ ì˜ìƒ ë³´ê¸°','https://www.youtube.com')">ìœ íŠœë¸Œ</span>
          </div>
        </div>
        <div class="form-row"><label>ìƒˆ íƒ­ ì—´ê¸°</label><select id="link-target"><option value="_blank">ìƒˆ íƒ­ì—ì„œ ì—´ê¸° (ê¶Œì¥)</option><option value="_self">í˜„ì¬ íƒ­ì—ì„œ ì—´ê¸°</option></select></div>
        <div class="form-row">
          <label>ë§í¬ í…ìŠ¤íŠ¸ <span class="req">*</span></label>
          <input type="text" id="link-text" placeholder="ì˜ˆ) ğŸ“‹ ì§€ê¸ˆ êµ¬ë§¤í•˜ê¸°" oninput="updateLinkPreview()" />
        </div>
        <div class="form-row" style="margin-bottom:0">
          <label>ì•„ì´ì½˜ (ì„ íƒ)</label>
          <div class="tag-row" style="margin-top:0">
            <span class="tag" onclick="addLinkIcon('ğŸ›’')">ğŸ›’</span><span class="tag" onclick="addLinkIcon('ğŸ“‹')">ğŸ“‹</span><span class="tag" onclick="addLinkIcon('ğŸ”—')">ğŸ”—</span><span class="tag" onclick="addLinkIcon('ğŸ‘†')">ğŸ‘†</span><span class="tag" onclick="addLinkIcon('âœ…')">âœ…</span><span class="tag" onclick="addLinkIcon('ğŸ“Œ')">ğŸ“Œ</span><span class="tag" onclick="addLinkIcon('ğŸ’Š')">ğŸ’Š</span><span class="tag" onclick="addLinkIcon('ğŸŒ¿')">ğŸŒ¿</span><span class="tag" onclick="addLinkIcon('ğŸ’°')">ğŸ’°</span><span class="tag" onclick="addLinkIcon('â¬†')">â¬†</span>
          </div>
        </div>
      </div>
      <div>
        <div class="form-row">
          <label>ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì„ íƒ</label>
          <div id="link-style-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:4px"></div>
        </div>
        <div class="form-row" style="margin-bottom:6px">
          <label>ğŸ“ ì‚½ì… ìœ„ì¹˜</label>
          <div id="link-pos-list" style="border:1.5px solid var(--border);border-radius:8px;overflow:hidden;max-height:160px;overflow-y:auto;background:white">
            <div style="padding:12px;text-align:center;color:var(--muted);font-size:12px">ì„¹ì…˜ì„ ì—´ë©´ ìë™ìœ¼ë¡œ ëª©ë¡ì´ ë‚˜íƒ€ë‚˜ìš”</div>
          </div>
        </div>
        <div class="form-row" style="margin-bottom:0">
          <label>ğŸ‘ ì„ íƒ ìœ„ì¹˜ ì»¨í…ìŠ¤íŠ¸</label>
          <div id="link-pos-context" style="border:1.5px solid var(--border);border-radius:8px;padding:8px;background:#fafafa;min-height:48px;max-height:90px;overflow-y:auto;font-size:10px;font-family:monospace;color:#555;white-space:pre-wrap;line-height:1.5">ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ìš”ì†Œ ì „í›„ ì½”ë“œê°€ í‘œì‹œë¼ìš”</div>
        </div>
      </div>
    </div>
    <!-- ì„¹ì…˜ ì „ì²´ ë¯¸ë¦¬ë³´ê¸° -->
    <div style="margin-top:14px">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
        <label style="font-size:12px;font-weight:600">ğŸ‘ ì‚½ì… ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</label>
        <div style="display:flex;gap:3px">
          <button id="link-prev-tab-simple" onclick="switchLinkPreviewTab('simple')" style="padding:3px 10px;border-radius:5px;border:1px solid var(--border);background:#1565c0;color:white;font-size:10.5px;cursor:pointer;font-family:'Noto Sans KR',sans-serif">ğŸ”— ë§í¬ë§Œ</button>
          <button id="link-prev-tab-full" onclick="switchLinkPreviewTab('full')" style="padding:3px 10px;border-radius:5px;border:1px solid var(--border);background:white;color:var(--muted);font-size:10.5px;cursor:pointer;font-family:'Noto Sans KR',sans-serif">ğŸ“„ ì„¹ì…˜ ì „ì²´</button>
        </div>
      </div>
      <div id="link-prev-simple-wrap" style="display:block">
        <div id="link-preview" style="background:white;border:1.5px solid var(--border);border-radius:8px;padding:14px;min-height:52px;display:flex;align-items:center;justify-content:center">
          <span style="font-size:11px;color:var(--muted)">í…ìŠ¤íŠ¸ì™€ URLì„ ì…ë ¥í•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ ë‚˜íƒ€ë‚˜ìš”</span>
        </div>
      </div>
      <div id="link-prev-full-wrap" style="display:none;border:1.5px solid var(--border);border-radius:8px;overflow:hidden">
        <div style="background:#f5f5f5;padding:6px 12px;font-size:11px;color:var(--muted);border-bottom:1px solid var(--border)">ì„¹ì…˜ì— ë§í¬ê°€ ì‚½ì…ëœ ëª¨ìŠµì„ ë¯¸ë¦¬ ë³¼ ìˆ˜ ìˆì–´ìš” (ì‹¤ì œ ì €ì¥ ì „)</div>
        <iframe id="link-section-preview-iframe" style="width:100%;height:320px;border:none;display:block;background:white"></iframe>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeModal('link')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="insertLink()">ğŸ”— ë§í¬ ì‚½ì…í•˜ê¸°</button>
    </div>
  </div>
</div>

<!-- HTML ì½”ë“œ ì‚½ì… MODAL -->
<div class="modal-overlay" id="modal-htmlsnippet">
  <div class="modal" style="max-width:820px;width:96%">
    <button class="modal-close" onclick="closeModal('htmlsnippet')">âœ•</button>
    <div class="modal-title">ğŸ§© HTML ì½”ë“œ ì§ì ‘ ì‚½ì…</div>
    <div class="modal-desc">ì§ì ‘ ë§Œë“  HTML ì½”ë“œë¥¼ ì›í•˜ëŠ” ìœ„ì¹˜ì— ì‚½ì…í•´ìš”. ê´‘ê³  ë°°ë„ˆ, ì œí’ˆ ì¹´ë“œ, ì»¤ìŠ¤í…€ ë°•ìŠ¤ ë“± ë¬´ì—‡ì´ë“  ë„£ì„ ìˆ˜ ìˆì–´ìš”.</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px">
      <div style="display:flex;flex-direction:column;gap:10px">
        <div class="form-row" style="margin-bottom:0">
          <label>ğŸ“ ë¶™ì—¬ë„£ì„ HTML ì½”ë“œ <span class="req">*</span></label>
          <textarea id="snippet-code" style="min-height:180px;font-size:11.5px;font-family:'Courier New',monospace;line-height:1.5;border:1.5px solid var(--border);border-radius:8px;padding:10px;resize:vertical;color:#333;background:#fafafa" placeholder="ì˜ˆ) &lt;div style=&quot;...&quot;&gt;ë‚´ìš©&lt;/div&gt;" oninput="updateSnippetPreview()"></textarea>
        </div>
        <div>
          <label style="font-size:11.5px;font-weight:600;color:var(--muted);display:block;margin-bottom:5px">âš¡ ë¹ ë¥¸ í…œí”Œë¦¿</label>
          <div style="display:flex;flex-wrap:wrap;gap:5px">
            <span class="tag" onclick="applySnippetTemplate('tip')">ğŸ’¡ íŒë°•ìŠ¤</span>
            <span class="tag" onclick="applySnippetTemplate('warn')">âš ï¸ ê²½ê³ ë°•ìŠ¤</span>
            <span class="tag" onclick="applySnippetTemplate('product')">ğŸ›’ ì œí’ˆì¹´ë“œ</span>
            <span class="tag" onclick="applySnippetTemplate('divider')">âœ‚ï¸ êµ¬ë¶„ì„ </span>
            <span class="tag" onclick="applySnippetTemplate('notice')">ğŸ“¢ ê³µì§€ë°°ë„ˆ</span>
            <span class="tag" onclick="applySnippetTemplate('table2')">ğŸ“Š 2ì—´ í‘œ</span>
          </div>
        </div>
        <div>
          <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px">ğŸ“ ì‚½ì… ìœ„ì¹˜</label>
          <div id="snippet-pos-list" style="border:1.5px solid var(--border);border-radius:8px;overflow:hidden;max-height:160px;overflow-y:auto;background:white">
            <div style="padding:12px;text-align:center;color:var(--muted);font-size:12px">ì„¹ì…˜ì„ ì—´ë©´ ìë™ìœ¼ë¡œ ëª©ë¡ì´ ë‚˜íƒ€ë‚˜ìš”</div>
          </div>
        </div>
        <div>
          <label style="font-size:12px;font-weight:600;display:block;margin-bottom:4px">ğŸ‘ ì„ íƒ ìœ„ì¹˜ ì»¨í…ìŠ¤íŠ¸</label>
          <div id="snippet-pos-context" style="border:1.5px solid var(--border);border-radius:8px;padding:8px;background:#fafafa;min-height:44px;max-height:80px;overflow-y:auto;font-size:10px;font-family:monospace;color:#555;white-space:pre-wrap;line-height:1.5">ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ìš”ì†Œ ì „í›„ ì½”ë“œê°€ í‘œì‹œë¼ìš”</div>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <label style="font-size:12px;font-weight:600">ğŸ‘ ë¯¸ë¦¬ë³´ê¸°</label>
          <div style="display:flex;gap:3px">
            <button id="snip-prev-tab-code" onclick="switchSnipPreviewTab('code')" style="padding:3px 10px;border-radius:5px;border:1px solid var(--border);background:#2e7d32;color:white;font-size:10.5px;cursor:pointer;font-family:'Noto Sans KR',sans-serif">ğŸ§© ì½”ë“œë§Œ</button>
            <button id="snip-prev-tab-full" onclick="switchSnipPreviewTab('full')" style="padding:3px 10px;border-radius:5px;border:1px solid var(--border);background:white;color:var(--muted);font-size:10.5px;cursor:pointer;font-family:'Noto Sans KR',sans-serif">ğŸ“„ ì„¹ì…˜ ì „ì²´</button>
          </div>
        </div>
        <div id="snip-prev-code" style="border:1.5px solid var(--border);border-radius:8px;overflow:hidden;min-height:380px">
          <iframe id="snip-code-iframe" style="width:100%;height:380px;border:none;display:block;background:white"></iframe>
        </div>
        <div id="snip-prev-full" style="display:none;border:1.5px solid var(--border);border-radius:8px;overflow:hidden;min-height:380px">
          <div style="background:#f5f5f5;padding:6px 12px;font-size:11px;color:var(--muted);border-bottom:1px solid var(--border)">ì„¹ì…˜ì— ì‚½ì…ëœ ìµœì¢… ëª¨ìŠµ (ì €ì¥ ì „ ë¯¸ë¦¬ë³´ê¸°)</div>
          <iframe id="snip-full-iframe" style="width:100%;height:374px;border:none;display:block;background:white"></iframe>
        </div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeModal('htmlsnippet')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="insertSnippet()">ğŸ§© ì½”ë“œ ì‚½ì…í•˜ê¸°</button>
    </div>
  </div>
</div>

<!-- HEADER -->
<div class="header">
  <button class="mobile-header-menu" onclick="toggleSidebar()" aria-label="ë©”ë‰´">â˜°</button>
  <div class="header-logo">ğŸ¥¬ <span>ì¬ë£Œ</span>ë¸”ë¡œê·¸ ìƒì„±ê¸°</div>
  <div class="header-sub">50ëŒ€+ ê±´ê°• ì¬ë£Œ ì •ë³´ ë¸”ë¡œê·¸ ìë™í™” Â· Gemini 2.5 ê²€ìƒ‰ ì—°ë™</div>
</div>

<div class="sidebar-backdrop" id="sidebar-backdrop" onclick="closeSidebar()"></div>

<div class="app">
  <aside class="sidebar">
    <div class="sidebar-title">ì§„í–‰ ë‹¨ê³„</div>
    <button class="step-btn active" onclick="goPanel('setup')" id="sb-setup"><div class="step-num">âš™</div><div><div class="step-label">ê¸°ë³¸ ì„¤ì •</div><div class="step-sublabel">ì¬ë£Œëª…Â·í‚¤ì›Œë“œÂ·ì»¬ëŸ¬</div></div></button>
    <button class="step-btn" onclick="goPanel('step1')" id="sb-step1"><div class="step-num">1</div><div><div class="step-label">ë©”íƒ€Â·ë„ì…ë¶€Â·ëª©ì°¨</div><div class="step-sublabel">STEP 1</div></div></button>
    <button class="step-btn" onclick="goPanel('step2')" id="sb-step2"><div class="step-num">2</div><div><div class="step-label">ì¬ë£Œ ì†Œê°œ</div><div class="step-sublabel">STEP 2 â€” ì„¹ì…˜ 1</div></div></button>
    <button class="step-btn" onclick="goPanel('step3')" id="sb-step3"><div class="step-num">3</div><div><div class="step-label">ì˜ì–‘ ì„±ë¶„ê³¼ íš¨ëŠ¥</div><div class="step-sublabel">STEP 3 â€” ì„¹ì…˜ 2</div></div></button>
    <button class="step-btn" onclick="goPanel('step4')" id="sb-step4"><div class="step-num">4</div><div><div class="step-label">ì¶”ì²œ ëŒ€ìƒ</div><div class="step-sublabel">STEP 4 â€” ì„¹ì…˜ 3</div></div></button>
    <button class="step-btn" onclick="goPanel('step5')" id="sb-step5"><div class="step-num">5</div><div><div class="step-label">ë¶€ì‘ìš©Â·ì£¼ì˜ì‚¬í•­</div><div class="step-sublabel">STEP 5 â€” ì„¹ì…˜ 4</div></div></button>
    <button class="step-btn" onclick="goPanel('step6')" id="sb-step6"><div class="step-num">6</div><div><div class="step-label">ì œì² Â·ê³ ë¥´ëŠ”ë²•Â·ë³´ê´€</div><div class="step-sublabel">STEP 6 â€” ì„¹ì…˜ 5</div></div></button>
    <button class="step-btn" onclick="goPanel('step7')" id="sb-step7"><div class="step-num">7</div><div><div class="step-label">ë§›ìˆê²Œ ë¨¹ëŠ” ë²•</div><div class="step-sublabel">STEP 7 â€” ì„¹ì…˜ 6</div></div></button>
    <button class="step-btn" onclick="goPanel('step8')" id="sb-step8"><div class="step-num">8</div><div><div class="step-label">êµ¬ì…ì²˜Â·ê°€ê²© ì •ë³´</div><div class="step-sublabel">STEP 8 â€” ì„¹ì…˜ 7</div></div></button>
    <button class="step-btn" onclick="goPanel('step9')" id="sb-step9"><div class="step-num">9</div><div><div class="step-label">FAQÂ·ìš”ì•½Â·ë§ˆë¬´ë¦¬</div><div class="step-sublabel">STEP 9 â€” ì™„ì„±</div></div></button>
    <button class="step-btn" onclick="goPanel('extra')" id="sb-extra"><div class="step-num">ğŸ“‹</div><div><div class="step-label">ë¶€ê°€ ì •ë³´</div><div class="step-sublabel">SEOÂ·íƒœê·¸Â·ì´ë¯¸ì§€ ê°€ì´ë“œ</div></div></button>
    <button class="step-btn" onclick="goPanel('compile');updateCompileChecklist()" id="sb-compile"><div class="step-num">âœ“</div><div><div class="step-label">ìµœì¢… ì™„ì„±ë³¸</div><div class="step-sublabel">ì „ì²´ HTML í•©ì¹˜ê¸°</div></div></button>
  </aside>

  <main class="main">
    <!-- ê¸°ë³¸ ì„¤ì • -->
    <div class="panel active" id="panel-setup">
      <div class="panel-title">âš™ï¸ ê¸°ë³¸ ì„¤ì •</div>
      <div class="panel-desc">ê¸€ ì‘ì„±ì— í•„ìš”í•œ ì •ë³´ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”. í•œ ë²ˆë§Œ ì„¤ì •í•˜ë©´ ëª¨ë“  STEPì— ìë™ ì ìš©ë¼ìš”.</div>
      <div class="info-banner" style="background:#e8f0fe;border-color:#a8c4f8">
        <h3 style="color:#1a56cc">ğŸ”‘ Google Gemini API í‚¤ê°€ í•„ìš”í•´ìš”</h3>
        <p style="color:#1565c0">Gemini API í‚¤ë¥¼ ì…ë ¥í•˜ë©´ ì¸í„°ë„· ê²€ìƒ‰ ê¸°ë°˜ìœ¼ë¡œ ìµœì‹  ì •ë³´ë¥¼ ë°˜ì˜í•œ ë¸”ë¡œê·¸ ê¸€ì„ ìƒì„±í•  ìˆ˜ ìˆì–´ìš”.<br>
        API í‚¤ëŠ” <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color:#1a56cc;font-weight:700">Google AI Studio</a>ì—ì„œ ë¬´ë£Œë¡œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆì–´ìš”.</p>
      </div>
      <div class="config-grid" style="margin-bottom:8px">
        <div class="field full">
          <label>Gemini API í‚¤ <span class="req">*</span></label>
          <input type="password" id="gemini-api-key" placeholder="AIzaSy..." autocomplete="off" />
          <div class="form-note">ì…ë ¥í•œ í‚¤ëŠ” ì´ í˜ì´ì§€ì—ì„œë§Œ ì‚¬ìš©ë˜ë©°, ì–´ë””ì—ë„ ì €ì¥Â·ì „ì†¡ë˜ì§€ ì•Šì•„ìš”.</div>
        </div>
      </div>
      <div class="config-grid">
        <div class="field">
          <label>ì¬ë£Œëª… <span class="req">*</span></label>
          <input type="text" id="ingredient" placeholder="ì˜ˆ) ì—¬ì£¼, í‘ë§ˆëŠ˜, ë¼ì§€ê°ì" />
        </div>
        <div class="field">
          <label>í¬ì»¤ìŠ¤ í‚¤ì›Œë“œ (SEO) <span class="req">*</span></label>
          <input type="text" id="keyword" placeholder="ì˜ˆ) ì—¬ì£¼ íš¨ëŠ¥, í‘ë§ˆëŠ˜ ë¶€ì‘ìš©" />
        </div>
        <div class="field full">
          <label>ì»¬ëŸ¬ í…Œë§ˆ ì„ íƒ <span class="req">*</span></label>
          <div class="color-options">
            <div class="color-opt" onclick="selectColor(1)" id="color1"><div class="color-swatch" style="background:linear-gradient(135deg,#1a73e8,#607d8b)">ğŸ”µ</div><div class="color-name">ë¸”ë£¨-ê·¸ë ˆì´<br>ì‹ ë¢°Â·ì •ë³´</div></div>
            <div class="color-opt selected" onclick="selectColor(2)" id="color2"><div class="color-swatch" style="background:linear-gradient(135deg,#2e7d32,#ef6c00)">ğŸŸ¢</div><div class="color-name">ê·¸ë¦°-ì˜¤ë Œì§€<br>ìì—°Â·ê±´ê°•</div></div>
            <div class="color-opt" onclick="selectColor(3)" id="color3"><div class="color-swatch" style="background:linear-gradient(135deg,#6a1b9a,#f9a825)">ğŸŸ£</div><div class="color-name">í¼í”Œ-ì˜ë¡œìš°<br>í•œë°©Â·ì•½ì¬</div></div>
            <div class="color-opt" onclick="selectColor(4)" id="color4"><div class="color-swatch" style="background:linear-gradient(135deg,#00695c,#b0bec5)">ğŸŸ¦</div><div class="color-name">í‹¸-ê·¸ë ˆì´<br>ì°¨ë¶„Â·í˜„ëŒ€</div></div>
            <div class="color-opt" onclick="selectColor(5)" id="color5"><div class="color-swatch" style="background:linear-gradient(135deg,#bf360c,#cfd8dc)">ğŸŸ¤</div><div class="color-name">í…Œë¼ì½”íƒ€<br>ì „í†µÂ·ë°œíš¨</div></div>
          </div>
        </div>
      </div>
      <button class="btn btn-primary btn-lg" onclick="saveConfig()">ì„¤ì • ì €ì¥ í›„ STEP 1 ì‹œì‘í•˜ê¸° â†’</button>
      <button class="btn btn-danger btn-sm" onclick="clearState()" style="margin-left:8px">ğŸ—‘ ì €ì¥ ë°ì´í„° ì´ˆê¸°í™”</button>
      <div id="config-alert" style="margin-top:12px"></div>
    </div>

    <div id="step-panels"></div>

    <!-- ìµœì¢… ì™„ì„±ë³¸ -->
    <div class="panel" id="panel-compile">
      <div class="panel-title">âœ… ìµœì¢… ì™„ì„±ë³¸</div>
      <div class="panel-desc">STEP 1~9 ê²°ê³¼ë¬¼ì„ í•˜ë‚˜ì˜ HTMLë¡œ í•©ì³ ë‹¤ìš´ë¡œë“œí•˜ê±°ë‚˜ ë³µì‚¬í•  ìˆ˜ ìˆì–´ìš”.</div>
      <div class="compile-grid" id="compile-checklist"></div>
      <div class="generate-area">
        <button class="btn btn-primary btn-lg" onclick="compileAll()">ğŸ”— ì „ì²´ HTML í•©ì¹˜ê¸°</button>
        <button class="btn btn-secondary" onclick="downloadAll()">â¬‡ï¸ HTML íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
      </div>
      <div id="compile-result"></div>
    </div>

    <!-- ë¶€ê°€ ì •ë³´ íŒ¨ë„ -->
    <div class="panel" id="panel-extra">
      <div class="panel-title">ğŸ“‹ ë¶€ê°€ ì •ë³´</div>
      <div class="panel-desc">ë¸”ë¡œê·¸ ë°œí–‰ì— í•„ìš”í•œ SEO ì •ë³´Â·ì¶”ì²œ íƒœê·¸Â·ì´ë¯¸ì§€ ê°€ì´ë“œì˜ˆìš”. HTML ë³¸ë¬¸ì—ëŠ” í¬í•¨ë˜ì§€ ì•Šì•„ìš”.<br>STEP 9 ìƒì„± í›„ ì•„ë˜ì— ìë™ìœ¼ë¡œ í‘œì‹œë¼ìš”.</div>
      <div id="extra-panel-empty" class="alert alert-warn" style="margin-bottom:16px">â³ STEP 9ë¥¼ ë¨¼ì € ìƒì„±í•´ì£¼ì„¸ìš”. ìƒì„±ì´ ì™„ë£Œë˜ë©´ ì—¬ê¸°ì— ìë™ìœ¼ë¡œ í‘œì‹œë¼ìš”.</div>
      <div id="extra-panel-content" style="display:none">
        <div style="display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap;align-items:center">
          <button class="btn btn-orange btn-lg" onclick="copyExtraInfo()">ğŸ“‹ ì „ì²´ ë³µì‚¬</button>
          <button class="btn btn-secondary" onclick="generateExtraInfo()">ğŸ”„ ë‹¤ì‹œ ìƒì„±</button>
        </div>
        <div class="result-box">
          <div class="result-header">
            <div class="result-title">ë¶€ê°€ ì •ë³´ ë‚´ìš©</div>
          </div>
          <div class="result-content">
            <div id="extra-info-body" style="padding:20px 22px;font-size:13px;line-height:2;color:#333;white-space:pre-wrap;font-family:'Noto Sans KR',sans-serif;min-height:200px"></div>
          </div>
        </div>
      </div>
      <div class="loading" id="extra-loading" style="display:none"><div class="spinner"></div> ë¶€ê°€ ì •ë³´ë¥¼ ìƒì„±í•˜ê³  ìˆì–´ìš”...</div>
    </div>
  </main>
</div>

<!-- ëª¨ë°”ì¼ í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
<nav class="mobile-nav-bar" id="mobile-nav-bar">
  <button class="mobile-nav-item active" id="mnav-setup" onclick="mobileNav('setup')">
    <span class="nav-icon">âš™ï¸</span><span class="nav-label">ì„¤ì •</span>
  </button>
  <button class="mobile-nav-item" id="mnav-steps" onclick="toggleSidebar()">
    <span class="nav-icon">ğŸ“</span><span class="nav-label">STEP</span>
  </button>
  <button class="mobile-nav-item" id="mnav-extra" onclick="mobileNav('extra')">
    <span class="nav-icon">ğŸ“‹</span><span class="nav-label">ë¶€ê°€ì •ë³´</span>
  </button>
  <button class="mobile-nav-item" id="mnav-compile" onclick="mobileNav('compile');updateCompileChecklist()">
    <span class="nav-icon">âœ…</span><span class="nav-label">ì™„ì„±ë³¸</span>
  </button>
</nav>

<script>
// ============================================================
// CONSTANTS & STATE
// ============================================================
const COLORS = {
  1:{main:'#1a73e8',sub:'#607d8b',name:'ë¸”ë£¨-ê·¸ë ˆì´'},
  2:{main:'#2e7d32',sub:'#ef6c00',name:'ê·¸ë¦°-ì˜¤ë Œì§€'},
  3:{main:'#6a1b9a',sub:'#f9a825',name:'í¼í”Œ-ì˜ë¡œìš°'},
  4:{main:'#00695c',sub:'#b0bec5',name:'í‹¸-ë¼ì´íŠ¸ê·¸ë ˆì´'},
  5:{main:'#bf360c',sub:'#cfd8dc',name:'í…Œë¼ì½”íƒ€-ë¼ì´íŠ¸ê·¸ë ˆì´'}
};

const STEPS = [
  {id:'step1', title:'ë©”íƒ€Â·ë„ì…ë¶€Â·ëª©ì°¨', emoji:'ğŸ“‹'},
  {id:'step2', title:'ì¬ë£Œ ì†Œê°œ', emoji:'ğŸŒ¿'},
  {id:'step3', title:'ì˜ì–‘ ì„±ë¶„ê³¼ íš¨ëŠ¥', emoji:'ğŸ’Š'},
  {id:'step4', title:'ì¶”ì²œ ëŒ€ìƒ', emoji:'ğŸ‘¥'},
  {id:'step5', title:'ë¶€ì‘ìš©Â·ì£¼ì˜ì‚¬í•­', emoji:'âš ï¸'},
  {id:'step6', title:'ì œì² Â·ê³ ë¥´ëŠ”ë²•Â·ë³´ê´€', emoji:'ğŸ›’'},
  {id:'step7', title:'ë§›ìˆê²Œ ë¨¹ëŠ” ë²•', emoji:'ğŸ³'},
  {id:'step8', title:'êµ¬ì…ì²˜Â·ê°€ê²© ì •ë³´', emoji:'ğŸ’°'},
  {id:'step9', title:'FAQÂ·ìš”ì•½Â·ë§ˆë¬´ë¦¬', emoji:'â“'},
];

let config = {};
let selectedColor = 2;
let results = {};
let htmlResults = {};
let extraResults = {};
let currentEditStep = null;
let currentImageStep = null;
let currentLinkStep = null;
let aiEditResult = null;
let imgBase64 = null;
let selectedLinkStyle = 'solid';
let autoRunning = false;

// ============================================================
// INIT STEP PANELS
// ============================================================
function initStepPanels() {
  const container = document.getElementById('step-panels');
  container.innerHTML = STEPS.map(s => `
    <div class="panel" id="panel-${s.id}">
      <div class="panel-title">${s.emoji} ${s.title}</div>
      <div class="panel-desc" id="desc-${s.id}">ì„¤ì •ì„ ë¨¼ì € ì €ì¥í•´ì£¼ì„¸ìš”.</div>
      <div class="step-info-bar" id="info-${s.id}"></div>
      <div class="generate-area" id="genarea-${s.id}">
        <button class="btn btn-primary btn-lg" id="genbtn-${s.id}" onclick="generateStep('${s.id}')">ğŸ¤– AIë¡œ ìƒì„±í•˜ê¸°</button>
        <button class="btn btn-secondary btn-sm" id="regenbtn-${s.id}" onclick="regenerateStep('${s.id}')" style="display:none">ğŸ”„ ë‹¤ì‹œ ìƒì„±</button>
      </div>
      <div class="progress-wrap"><div class="progress-bar" id="prog-${s.id}" style="width:0%"></div></div>
      <div id="result-${s.id}"></div>
    </div>
  `).join('');
}

// ============================================================
// NAVIGATION
// ============================================================
function goPanel(id) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.step-btn').forEach(b => b.classList.remove('active'));
  const panel = document.getElementById('panel-'+id);
  const btn = document.getElementById('sb-'+id);
  if(panel) panel.classList.add('active');
  if(btn) btn.classList.add('active');
  closeSidebar();
  // ëª¨ë°”ì¼ í•˜ë‹¨ íƒ­ active ë™ê¸°í™”
  ['setup','extra','compile'].forEach(k => {
    const el = document.getElementById('mnav-'+k);
    if(el) el.classList.toggle('active', k === id);
  });
  if(!['setup','extra','compile'].includes(id)) {
    const stepsBtn = document.getElementById('mnav-steps');
    if(stepsBtn) stepsBtn.classList.add('active');
    ['setup','extra','compile'].forEach(k => {
      const el = document.getElementById('mnav-'+k);
      if(el) el.classList.remove('active');
    });
  }
  // íŒ¨ë„ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
  if(window.innerWidth <= 768) window.scrollTo({top:0,behavior:'smooth'});
}

// ============================================================
// MOBILE SIDEBAR
// ============================================================
function toggleSidebar() {
  const sb = document.querySelector('.sidebar');
  const bd = document.getElementById('sidebar-backdrop');
  const isOpen = sb.classList.contains('open');
  if(isOpen) { closeSidebar(); } else {
    sb.classList.add('open');
    bd.classList.add('open');
    document.body.style.overflow = 'hidden';
  }
}

function closeSidebar() {
  const sb = document.querySelector('.sidebar');
  const bd = document.getElementById('sidebar-backdrop');
  sb.classList.remove('open');
  bd.classList.remove('open');
  document.body.style.overflow = '';
}

function mobileNav(id) {
  goPanel(id);
  // í•˜ë‹¨ íƒ­ active
  ['setup','steps','extra','compile'].forEach(k => {
    const el = document.getElementById('mnav-'+k);
    if(el) el.classList.toggle('active', k === id);
  });
}

// ============================================================
// COLOR SELECT
// ============================================================
function selectColor(n) {
  selectedColor = n;
  document.querySelectorAll('.color-opt').forEach(el => el.classList.remove('selected'));
  document.getElementById('color'+n).classList.add('selected');
}

// ============================================================
// SAVE CONFIG
// ============================================================
function saveConfig() {
  const ingredient = document.getElementById('ingredient').value.trim();
  const keyword = document.getElementById('keyword').value.trim();
  const geminiKey = document.getElementById('gemini-api-key').value.trim();
  const alertEl = document.getElementById('config-alert');
  if(!ingredient) { alertEl.innerHTML='<div class="alert alert-error">âŒ ì¬ë£Œëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>'; return; }
  if(!keyword) { alertEl.innerHTML='<div class="alert alert-error">âŒ í¬ì»¤ìŠ¤ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>'; return; }
  if(!geminiKey) { alertEl.innerHTML='<div class="alert alert-error">âŒ Gemini API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>'; return; }
  config = {ingredient, keyword, colorNum: selectedColor, geminiKey};
  alertEl.innerHTML='<div class="alert alert-success">âœ… ì„¤ì • ì €ì¥ ì™„ë£Œ! STEP 1ë¡œ ì´ë™í•´ìš”.</div>';
  saveState();
  STEPS.forEach(s => {
    const info = document.getElementById('info-'+s.id);
    const desc = document.getElementById('desc-'+s.id);
    if(info) { info.innerHTML=`ğŸ“Œ ì¬ë£Œëª…: <strong>${ingredient}</strong> &nbsp;|&nbsp; ğŸ”‘ í‚¤ì›Œë“œ: <strong>${keyword}</strong> &nbsp;|&nbsp; ğŸ¨ ì»¬ëŸ¬: <strong>${COLORS[selectedColor].name}</strong>`; info.style.display='block'; }
    if(desc) desc.textContent=`${ingredient}ì— ëŒ€í•œ ${s.title} ì„¹ì…˜ì„ AIë¡œ ìƒì„±í•´ìš”.`;
  });
  setTimeout(() => {
    goPanel('step1');
    autoRunAllSteps();
  }, 700);
}

// ============================================================
// AUTO RUN ALL STEPS
// ============================================================
async function autoRunAllSteps() {
  if(autoRunning) return;
  autoRunning = true;
  for(const s of STEPS) {
    goPanel(s.id);
    await generateStep(s.id);
    // ì˜¤ë¥˜ ì‹œ ì¤‘ë‹¨ ì—¬ë¶€ í™•ì¸
    const resultEl = document.getElementById('result-'+s.id);
    if(resultEl && resultEl.querySelector('.alert-error')) {
      autoRunning = false;
      showToast('âš ï¸ ' + s.title + ' ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•´ ìë™ ìƒì„±ì„ ì¤‘ë‹¨í–ˆì–´ìš”.');
      return;
    }
  }
  autoRunning = false;
  // STEP 1~9 ì™„ë£Œ í›„ ë¶€ê°€ ì •ë³´ ìë™ ìƒì„±
  showToast('ğŸ“‹ ë¶€ê°€ ì •ë³´ë¥¼ ìƒì„±í•˜ê³  ìˆì–´ìš”...');
  goPanel('extra');
  await generateExtraInfo();
  showToast('ğŸ‰ ëª¨ë“  STEP + ë¶€ê°€ ì •ë³´ ìƒì„± ì™„ë£Œ!');
  setTimeout(() => { goPanel('compile'); updateCompileChecklist(); }, 1000);
}

// ============================================================
// PROMPTS
// ============================================================
function getSystemPrompt() {
  const c = COLORS[config.colorNum];
  return `ë‹¹ì‹ ì€ 50ëŒ€ ì´ìƒ ì¤‘ë…„ ë…ìë¥¼ ìœ„í•œ ì¬ë£Œ ì •ë³´ ë¸”ë¡œê·¸ ì „ë¬¸ ì‘ê°€ì…ë‹ˆë‹¤.

í˜„ì¬ ì„¤ì •:
- ì¬ë£Œëª…: ${config.ingredient}
- í¬ì»¤ìŠ¤ í‚¤ì›Œë“œ: ${config.keyword}
- ë©”ì¸ ì»¬ëŸ¬: ${c.main} / ë³´ì¡° ì»¬ëŸ¬: ${c.sub}

ê³µí†µ ì›ì¹™:
â‘  ë¬¸ì²´Â·í†¤: ì¹œê·¼í•œ ëŒ€í™”ì²´("~ì´ì—ìš”","~í•´ìš”"), 1ì¸ì¹­ ì‹œì , ì „ë¬¸ìš©ì–´ ê´„í˜¸ í’€ì´ í•„ìˆ˜, ë‹¨ì •Â·ê³¼ì¥ ê¸ˆì§€
â‘¡ ì •í™•ì„±: ì¶œì²˜ ë¶ˆëª… ìˆ˜ì¹˜ ê¸ˆì§€, ë¶ˆí™•ì‹¤í•˜ë©´ ë²”ìœ„ê°’ ë˜ëŠ” "ê³µì‹ ìë£Œ í™•ì¸" í‘œê¸°
â‘¢ ì¶œë ¥: HTMLì€ ë°˜ë“œì‹œ \`\`\`html ... \`\`\` ì½”ë“œ ë¸”ë¡ìœ¼ë¡œë§Œ ì¶œë ¥

HTML ê³µí†µ êµ¬ì¡°:
- ë˜í¼: <div style="font-family:'Noto Sans KR',sans-serif;line-height:1.6;max-width:800px;margin:0 auto;font-size:16px;">
- H2: <h2 id="sectionN" style="font-size:22px;color:${c.main};margin:56px 0 16px;padding-bottom:10px;border-bottom:2px solid #eaeaea;">
- H3: <h3 style="font-size:18px;color:#444;margin:36px 0 12px;padding-left:4px;border-left:3px solid ${c.main};">
- íŒë°•ìŠ¤: background-color:${c.sub}22;border-left:4px solid ${c.main};padding:14px;border-radius:0 8px 8px 0;
- ê²½ê³ ë°•ìŠ¤: background-color:#ffebee;border-left:4px solid #f44336;padding:14px;border-radius:0 8px 8px 0;`;
}

function getStepPrompt(stepId) {
  const i = config.ingredient, k = config.keyword, c = COLORS[config.colorNum];
  const p = {
    step1:`STEP 1: ì„¹ì…˜ ë³¸ë¬¸ì€ ì“°ì§€ ë§ê³  ì•„ë˜ 4ê°€ì§€ë§Œ ì‘ì„±í•˜ì„¸ìš”.
1) HTML ì£¼ì„ ë©”íƒ€ë””ìŠ¤í¬ë¦½ì…˜(150ìì´ë‚´,${k}í¬í•¨)
2) ë©”íƒ€ì„¤ëª…ë°•ìŠ¤(div,#fef9e7ë°°ê²½,${k}í¬í•¨ì§ˆë¬¸í˜•íƒœ)
3) ë„ì…ë¶€(píƒœê·¸2~3ê°œ,ê³µê°ê²½í—˜ìœ¼ë¡œì‹œì‘,ì²«ë¬¸ì¥ì—${k}í¬í•¨,ì´ëª¨í‹°ì½˜í™œìš©)
4) ëª©ì°¨TOC(nav+ol,href="#sectionN",ì•„ë˜8ê°œì œëª©ê·¸ëŒ€ë¡œ)
   1.${i}ì´ë€ ë¬´ì—‡ì¸ê°€ìš”? ğŸŒ¿ / 2.${i}ì˜ ì˜ì–‘ ì„±ë¶„ê³¼ íš¨ëŠ¥ ğŸ’Š / 3.ì´ëŸ° ë¶„ë“¤ê»˜ íŠ¹íˆ ì¢‹ì•„ìš” ğŸ‘¥ / 4.ë¶€ì‘ìš©ê³¼ ì£¼ì˜ì‚¬í•­ âš ï¸ / 5.ì œì² ê³¼ ê³ ë¥´ëŠ” ë²•, ë³´ê´€í•˜ëŠ” ë²• ğŸ›’ / 6.${i} ë§›ìˆê²Œ ë¨¹ëŠ” ë²•ê³¼ í™œìš© ìš”ë¦¬ ğŸ³ / 7.êµ¬ì…ì²˜ì™€ ê°€ê²© ì •ë³´, ì´ë ‡ê²Œ í™œìš©í•˜ì„¸ìš” ğŸ’° / 8.ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ â“
ë©”ì¸ì»¬ëŸ¬:${c.main}`,
    step2:`STEP 2 â€” ì„¹ì…˜1ë§Œ: "${i}ì´ë€ ë¬´ì—‡ì¸ê°€ìš”? ğŸŒ¿" (id="section1")
H3 3ê°œì´ìƒ(1-1.ì •ì˜Â·ì‹ë¬¼í•™ì íŠ¹ì§•/1-2.ì›ì‚°ì§€Â·ì¬ë°°Â·ìœ í†µ/1-3.ì´ë¦„ìœ ë˜Â·ì—­ì‚¬Â·í•œì˜í•™)
í•„ìˆ˜: â‘ ì¬ë£Œê¸°ë³¸ì •ë³´í‘œ(í•™ëª…/ë¶„ë¥˜Â·ì›ì‚°ì§€Â·ì œì² Â·ì£¼ì‚°ì§€Â·ì¹¼ë¡œë¦¬100g) â‘¡ì—­ì‚¬ì¼í™” íŒë°•ìŠ¤ â‘¢${k} 2~3íšŒ`,
    step3:`STEP 3 â€” ì„¹ì…˜2ë§Œ: "${i}ì˜ ì˜ì–‘ ì„±ë¶„ê³¼ íš¨ëŠ¥ ğŸ’Š" (id="section2")
H3 3ê°œì´ìƒ(2-1.ì£¼ìš”ì˜ì–‘ì„±ë¶„/2-2.ê±´ê°•íš¨ëŠ¥/2-3.ê³¼í•™ì ì—°êµ¬Â·í•œì˜í•™)
í•„ìˆ˜: â‘ ì˜ì–‘ì„±ë¶„í‘œ(100gê¸°ì¤€Â·ì¶œì²˜Â·ì—°ë„) â‘¡íŒë°•ìŠ¤"ì´ ì„±ë¶„ì€ ì–´ë–»ê²Œ ì‘ìš©í•˜ë‚˜ìš”?" â‘¢ì§ˆí™˜ì¹˜ë£Œë‹¨ì •ê¸ˆì§€, ${k}2~3íšŒ`,
    step4:`STEP 4 â€” ì„¹ì…˜3ë§Œ: "ì´ëŸ° ë¶„ë“¤ê»˜ íŠ¹íˆ ì¢‹ì•„ìš” ğŸ‘¥" (id="section3")
H3 3ê°œì´ìƒ(3-1.ë‚˜ì´ì„±ë³„ë³„/3-2.ê±´ê°•ìƒíƒœë³„/3-3.ìƒí™œìŠµê´€ë³„)
í•„ìˆ˜: â‘ ì´ëª¨í‹°ì½˜+ì¶”ì²œëŒ€ìƒ ë°•ìŠ¤ â‘¡ê³µê°ê²½í—˜ë‹´1ê°œ, ${k}1~2íšŒ`,
    step5:`STEP 5 â€” ì„¹ì…˜4ë§Œ: "ë¶€ì‘ìš©ê³¼ ì£¼ì˜ì‚¬í•­ âš ï¸" (id="section4")
H3 3ê°œì´ìƒ(4-1.ê³¼ë‹¤ì„­ì·¨ì¦ìƒÂ·ì ì •ëŸ‰/4-2.ì§ˆí™˜ìÂ·ì•½ë¬¼ìƒí˜¸ì‘ìš©/4-3.ì•Œë ˆë¥´ê¸°Â·ì²´ì§ˆ)
í•„ìˆ˜: â‘ ê²½ê³ ë°•ìŠ¤(#fff8e1ë°°ê²½Â·ì£¼í™©borderÂ·ì£¼ì˜ëŒ€ìƒëª©ë¡) â‘¡ê³¼ë‹¤ì„­ì·¨ì¦ìƒul â‘¢ì ì •ì„­ì·¨ëŸ‰íŒë°•ìŠ¤(ì¶œì²˜Â·ì—°ë„), ${k}1~2íšŒ`,
    step6:`STEP 6 â€” ì„¹ì…˜5ë§Œ: "ì œì² ê³¼ ê³ ë¥´ëŠ” ë²•, ë³´ê´€í•˜ëŠ” ë²• ğŸ›’" (id="section5")
H3 3ê°œì´ìƒ(5-1.ì œì² Â·ì‚°ì§€/5-2.ê³ ë¥´ëŠ”ë²•/5-3.ë³´ê´€ë²•Â·ìœ í†µê¸°í•œ)
í•„ìˆ˜: â‘ ì›”ë³„ì œì² ì •ë³´í‘œ â‘¡ì˜ëª»ëœë³´ê´€ê²½ê³ ë°•ìŠ¤ â‘¢ì˜¤ë˜ë³´ê´€ê¿€íŒë°•ìŠ¤, ${k}2íšŒ`,
    step7:`STEP 7 â€” ì„¹ì…˜6ë§Œ: "${i} ë§›ìˆê²Œ ë¨¹ëŠ” ë²•ê³¼ í™œìš© ìš”ë¦¬ ğŸ³" (id="section6")
H3 3ê°œì´ìƒ(6-1.ê¸°ë³¸ì†ì§ˆÂ·ì „ì²˜ë¦¬/6-2.ëŒ€í‘œë ˆì‹œí”¼2~3ê°€ì§€/6-3.ì¬ë£Œê¶í•©)
í•„ìˆ˜: â‘ ë ˆì‹œí”¼ë°•ìŠ¤2~3ê°œ(ì¬ë£ŒÂ·ì¡°ë¦¬ë²•Â·ìš”ë¦¬í¬ì¸íŠ¸Â·ë‚œì´ë„â­) â‘¡ê¶í•©í‘œ(âœ…ì¢‹ì€ê¶í•©/âŒí”¼í•´ì•¼í• ê¶í•©/ì´ìœ ) â‘¢í•„ììš”ë¦¬ê²½í—˜ë‹´, ${k}2~3íšŒ`,
    step8:`STEP 8 â€” ì„¹ì…˜7ë§Œ: "êµ¬ì…ì²˜ì™€ ê°€ê²© ì •ë³´, ì´ë ‡ê²Œ í™œìš©í•˜ì„¸ìš” ğŸ’°" (id="section7")
H3 3ê°œì´ìƒ(7-1.êµ¬ì…ì²˜ë¹„êµ/7-2.ê°€ê²©ëŒ€Â·ì„ íƒê¸°ì¤€/7-3.ê°€ê³µí’ˆì£¼ì˜)
í•„ìˆ˜: â‘ êµ¬ì…ì²˜ë¹„êµí‘œ(ì „í†µì‹œì¥Â·ë§ˆíŠ¸Â·ì˜¨ë¼ì¸,êµ¬ì…ì²˜/ê°€ê²©ëŒ€/ì¥ì /ë‹¨ì ) â‘¡ë¹¨ê°„borderì£¼ì˜ë°•ìŠ¤"ì´ëŸ° ì œí’ˆì€ í”¼í•˜ì„¸ìš”" â‘¢ê°€ì„±ë¹„íŒë°•ìŠ¤, ${k}1~2íšŒ`,
    step9:`STEP 9 â€” ë§ˆì§€ë§‰, ì•„ë˜ ëª¨ë‘ ì‘ì„±í•˜ì„¸ìš”.
ã€ì„¹ì…˜8: ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ â“ã€‘id="section8" Q&A 5ê°œì´ìƒ(ê¸°ì´ˆÂ·ì˜¤í•´í•´ì†ŒÂ·ì‹¤ìš©ì§ˆë¬¸)
ã€í•µì‹¬ìš”ì•½ì¹´ë“œã€‘border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 6px 18px rgba(0,0,0,0.06) ì¹´ë“œ, "í•œëˆˆì— ë³´ëŠ” í•µì‹¬ ìš”ì•½" í—¤ë”(ë©”ì¸ì»¬ëŸ¬:${c.main}), í•µì‹¬5ê°€ì§€ul
ã€ë§ˆë¬´ë¦¬ã€‘â‘ ë…ìì‘ì›+ëŒ“ê¸€ìœ ë„ â‘¡ë©´ì±…ì¡°í•­(font-size:14px;color:#888)
í¬ì»¤ìŠ¤í‚¤ì›Œë“œ:${k}`,
  };
  return p[stepId] || '';
}

// ============================================================
// GEMINI API CALL (Google Gemini 2.5 Flash with Search Grounding)
// ============================================================
async function callGemini(system, user, maxTokens=8000) {
  const apiKey = config.geminiKey;
  if(!apiKey) throw new Error('Gemini API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ì–´ìš”. ê¸°ë³¸ ì„¤ì •ì—ì„œ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
  const model = 'gemini-2.5-flash';
  const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
  const body = {
    systemInstruction: { parts: [{ text: system }] },
    contents: [{ role: 'user', parts: [{ text: user }] }],
    // tools: [{ googleSearch: {} }],
    generationConfig: {
      maxOutputTokens: maxTokens,
      temperature: 0.7
    }
  };
  const response = await fetch(url, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  });
  if(!response.ok) {
    const e = await response.json().catch(()=>({}));
    const msg = e.error?.message || `API ì˜¤ë¥˜ (${response.status})`;
    throw new Error(msg);
  }
  const data = await response.json();
  const candidate = data.candidates?.[0];
  if(!candidate) throw new Error('ì‘ë‹µì´ ë¹„ì–´ìˆì–´ìš”. API í‚¤ë‚˜ ëª¨ë¸ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
  const parts = candidate.content?.parts || [];
  return parts.map(p => p.text || '').join('\n');
}

// í•˜ìœ„ í˜¸í™˜: callClaude -> callGemini
async function callClaude(system, user, maxTokens=8000) {
  return callGemini(system, user, maxTokens);
}

function extractHTML(rawText) {
  const m = rawText.match(/```html\s*([\s\S]*?)```/i);
  return m ? m[1].trim() : '';
}

// HTML ì½”ë“œ ë¸”ë¡ ì´í›„ì˜ ë¶€ê°€ ì •ë³´ í…ìŠ¤íŠ¸ ì¶”ì¶œ
function extractExtraInfo(rawText) {
  // ë§ˆì§€ë§‰ ``` ì´í›„ì˜ í…ìŠ¤íŠ¸ë¥¼ ë¶€ê°€ ì •ë³´ë¡œ ì¶”ì¶œ
  const lastCodeEnd = rawText.lastIndexOf('```');
  if(lastCodeEnd === -1) return '';
  const after = rawText.slice(lastCodeEnd + 3).trim();
  return after;
}

// ============================================================
// GENERATE STEP
// ============================================================
async function generateStep(stepId) {
  if(!config.ingredient) { alert('ë¨¼ì € ê¸°ë³¸ ì„¤ì •ì—ì„œ ì¬ë£Œëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); goPanel('setup'); return; }
  const resultEl = document.getElementById('result-'+stepId);
  const progEl = document.getElementById('prog-'+stepId);
  const btnEl = document.getElementById('genbtn-'+stepId);
  const regenBtn = document.getElementById('regenbtn-'+stepId);
  resultEl.innerHTML = '<div class="loading"><div class="spinner"></div> AIê°€ ê¸€ì„ ìƒì„±í•˜ê³  ìˆì–´ìš”... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” âœ¨</div>';
  progEl.style.width = '20%';
  btnEl.disabled = true;
  if(regenBtn) regenBtn.style.display = 'none';
  try {
    progEl.style.width = '50%';
    const rawText = await callClaude(getSystemPrompt(), getStepPrompt(stepId), 8000);
    progEl.style.width = '100%';
    results[stepId] = rawText;
    const htmlCode = extractHTML(rawText);
    htmlResults[stepId] = htmlCode;
    renderResult(stepId, rawText, htmlCode);
    markSidebarDone(stepId);
    if(regenBtn) regenBtn.style.display = 'inline-flex';
    if(stepId === 'step9') {
      renderExtraInfoPanel();
    }
    saveState();
  } catch(err) {
    resultEl.innerHTML = `<div class="alert alert-error">âŒ ì˜¤ë¥˜: ${err.message}<br>ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>`;
    progEl.style.width = '0%';
  }
  btnEl.disabled = false;
}

function regenerateStep(stepId) {
  if(confirm('ì´ë¯¸ ìƒì„±ëœ ë‚´ìš©ì„ ë‹¤ì‹œ ìƒì„±í• ê¹Œìš”? ìˆ˜ì •í•œ ë‚´ìš©ë„ ì´ˆê¸°í™”ë¼ìš”.')) generateStep(stepId);
}

// ============================================================
// RENDER RESULT
// ============================================================
function renderResult(stepId, rawText, htmlCode) {
  const resultEl = document.getElementById('result-'+stepId);
  resultEl.innerHTML = `
    <div class="toolbar">
      <span class="toolbar-label">ì„¹ì…˜ í¸ì§‘</span>
      <button class="btn btn-orange btn-sm" onclick="openEditModal('${stepId}')">âœï¸ ìˆ˜ì •í•˜ê¸°</button>
      <button class="btn btn-secondary btn-sm" onclick="regenerateStep('${stepId}')">ğŸ”„ ë‹¤ì‹œ ìƒì„±</button>
      <div class="toolbar-sep"></div>
      <span class="toolbar-label">ì‚½ì…</span>
      <button class="btn btn-blue btn-sm" onclick="openImageModal('${stepId}')">ğŸ–¼ï¸ ì´ë¯¸ì§€ ì‚½ì…</button>
      <button class="btn btn-blue btn-sm" onclick="openLinkModal('${stepId}')">ğŸ”— ë§í¬ ì‚½ì…</button>
      <button class="btn btn-sm" style="background:#7b1fa2;color:white" onclick="openSnippetModal('${stepId}')">ğŸ§© HTML ì‚½ì…</button>
      <div class="toolbar-sep"></div>
      <button class="btn btn-sm" style="background:#f5f5f5;border:1px solid var(--border)" onclick="copyHTMLStep('${stepId}')">ğŸ“‹ HTML ë³µì‚¬</button>
    </div>
    <div class="result-box">
      <div class="result-header">
        <div class="result-title">ìƒì„± ê²°ê³¼</div>
        <div style="display:flex;gap:4px;align-items:center">
          <div class="result-tabs" id="tabs-${stepId}">
            <button class="tab-btn active" onclick="switchTab('${stepId}','preview')">ë¯¸ë¦¬ë³´ê¸°</button>
            <button class="tab-btn" onclick="switchTab('${stepId}','code')">HTML ì½”ë“œ</button>
            <button class="tab-btn" onclick="switchTab('${stepId}','raw')">ì „ì²´ ì‘ë‹µ</button>
          </div>
        </div>
      </div>
      <div class="result-content">
        <div id="tab-preview-${stepId}">
          ${htmlCode
            ? `<iframe class="preview-frame" id="iframe-${stepId}" style="height:460px"></iframe>`
            : '<div class="alert alert-warn" style="margin:12px">HTML ì½”ë“œ ë¸”ë¡ì„ ì°¾ì§€ ëª»í–ˆì–´ìš”. ì „ì²´ ì‘ë‹µ íƒ­ì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”.</div>'}
        </div>
        <div id="tab-code-${stepId}" style="display:none"><div class="code-view" id="codeview-${stepId}">${escHtml(htmlCode||'(HTML ì—†ìŒ)')}</div></div>
        <div id="tab-raw-${stepId}" style="display:none"><div class="code-view">${escHtml(rawText)}</div></div>
      </div>
    </div>
    <div class="alert alert-success">âœ… ìƒì„± ì™„ë£Œ! íˆ´ë°”ì—ì„œ ìˆ˜ì •Â·ì´ë¯¸ì§€Â·ë§í¬ ì‚½ì…ì´ ê°€ëŠ¥í•´ìš”.</div>
  `;
  if(htmlCode) {
    const iframe = document.getElementById('iframe-'+stepId);
    writeIframe(iframe, htmlCode);
  }
}

function buildPreviewDoc(htmlCode) {
  return '<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8">' +
    '<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">' +
    '<style>body{margin:20px;background:#fff;font-family:\'Noto Sans KR\',sans-serif}img{max-width:100%}</style>' +
    '</head><body>' + (htmlCode || '') + '</body></html>';
}

// srcdoc ë°©ì‹ìœ¼ë¡œ iframeì— ì•ˆì „í•˜ê²Œ ë Œë”ë§ (blob URL ì°¨ë‹¨ ë¬¸ì œ ë°©ì§€)
function writeIframe(iframe, htmlCode) {
  if(!iframe) return;
  const doc = buildPreviewDoc(htmlCode);
  iframe.srcdoc = doc;
}

function refreshPreview(stepId) {
  const iframe = document.getElementById('iframe-'+stepId);
  if(iframe) writeIframe(iframe, htmlResults[stepId]||'');
  const codeView = document.getElementById('codeview-'+stepId);
  if(codeView) codeView.textContent = htmlResults[stepId]||'';
}

function switchTab(stepId, tab) {
  ['preview','code','raw'].forEach(t => {
    const el = document.getElementById('tab-'+t+'-'+stepId);
    if(el) el.style.display = t===tab ? 'block' : 'none';
  });
  const tabs = document.getElementById('tabs-'+stepId);
  if(tabs) tabs.querySelectorAll('.tab-btn').forEach((b,i) => {
    b.classList.toggle('active', ['preview','code','raw'][i]===tab);
  });
}

function copyExtraInfo() {
  const text = extraResults['step9'] || '';
  if(!text) { showToast('âš ï¸ ë¶€ê°€ ì •ë³´ê°€ ì—†ì–´ìš”. STEP 9ë¥¼ ë¨¼ì € ìƒì„±í•´ì£¼ì„¸ìš”.'); return; }
  if(navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text).then(() => showToast('âœ… ë¶€ê°€ ì •ë³´ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ëì–´ìš”!')).catch(() => copyFallback(text));
  } else copyFallback(text);
}

function renderExtraInfoPanel() {
  const text = extraResults['step9'] || '';
  const empty = document.getElementById('extra-panel-empty');
  const content = document.getElementById('extra-panel-content');
  const body = document.getElementById('extra-info-body');
  const sideBtn = document.getElementById('sb-extra');
  if(!body) return;
  if(!text) {
    if(empty) empty.style.display = 'block';
    if(content) content.style.display = 'none';
    return;
  }
  body.textContent = text;
  if(empty) empty.style.display = 'none';
  if(content) content.style.display = 'block';
  if(sideBtn) sideBtn.classList.add('done');
}

async function generateExtraInfo() {
  if(!config.ingredient) { alert('ë¨¼ì € ê¸°ë³¸ ì„¤ì •ì—ì„œ ì¬ë£Œëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
  const loadingEl = document.getElementById('extra-loading');
  const empty = document.getElementById('extra-panel-empty');
  const content = document.getElementById('extra-panel-content');
  if(loadingEl) loadingEl.style.display = 'flex';
  if(empty) empty.style.display = 'none';
  if(content) content.style.display = 'none';
  try {
    const rawText = await callGemini(getSystemPrompt(), getExtraInfoPrompt(), 4000);
    extraResults['step9'] = rawText.trim();
    renderExtraInfoPanel();
    showToast('âœ… ë¶€ê°€ ì •ë³´ ìƒì„± ì™„ë£Œ!');
    saveState();
  } catch(err) {
    if(empty) { empty.className = 'alert alert-error'; empty.textContent = 'âŒ ì˜¤ë¥˜: ' + err.message; empty.style.display = 'block'; }
  }
  if(loadingEl) loadingEl.style.display = 'none';
}

function getExtraInfoPrompt() {
  const i = config.ingredient, k = config.keyword;
  return `ì•„ë˜ í•­ëª©ì„ ìˆœì„œëŒ€ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”. HTML ì—†ì´ í…ìŠ¤íŠ¸ë¡œë§Œ ì¶œë ¥í•˜ì„¸ìš”.

â–  ë©”íƒ€ë””ìŠ¤í¬ë¦½ì…˜ (150ì ì´ë‚´, í¬ì»¤ìŠ¤ í‚¤ì›Œë“œ í¬í•¨)
[150ì ì´ë‚´ë¡œ ì‘ì„±]

â–  ì¶”ì²œ íƒœê·¸ (20ê°œ, ì‰¼í‘œ êµ¬ë¶„)
#${k} #${i}íš¨ëŠ¥ #${i}ë¶€ì‘ìš© ... (ì´ 20ê°œ)

â–  ëŒ€í‘œ ì´ë¯¸ì§€ ìƒì„± í”„ë¡¬í”„íŠ¸ (ì˜ë¬¸)
"[${i}ì˜ ì‹ ì„ í•˜ê³  í’ì„±í•œ ì´ë¯¸ì§€ë¥¼ ë¬˜ì‚¬í•˜ëŠ” ìƒì„¸í•œ ì˜ë¬¸ í”„ë¡¬í”„íŠ¸]"

â–  SEO ìµœì í™” ì œëª© ì œì•ˆ (5ê°œ)
â€» ëª¨ë“  ì œëª©ì€ "${i}ì˜ íš¨ëŠ¥ê³¼ ë¶€ì‘ìš©"ìœ¼ë¡œ ì‹œì‘
â€» ê³µë°± í¬í•¨ 45ì ì´ìƒ 55ì ì´ë‚´ (ì‘ì„± í›„ ê¸€ììˆ˜ ì§ì ‘ ì„¸ì–´ í‘œê¸°, 45ì ë¯¸ë§Œì´ë©´ ì¬ì‘ì„±)
1. ... â†’ â—‹â—‹ì
2. ... â†’ â—‹â—‹ì
3. ... â†’ â—‹â—‹ì
4. ... â†’ â—‹â—‹ì
5. ... â†’ â—‹â—‹ì

â–  ì°¸ê³  ì¸ìš© ì¶œì²˜
[ì¶œì²˜ URL 1]
[ì¶œì²˜ URL 2]
[ì¶œì²˜ URL 3]
[ì¶œì²˜ URL 4]
[ì¶œì²˜ URL 5]

â–  ë§ì¶¤ í¼ë¨¸ë§í¬ ì œì•ˆ (ì˜ë¬¸ ì†Œë¬¸ì-í•˜ì´í”ˆ)
[permalink-1]
[permalink-2]
[permalink-3]

â–  ì„¹ì…˜ë³„ ì´ë¯¸ì§€ ì •ë³´ (í‘œ í˜•ì‹)
ì„¹ì…˜ | ì„¹ì…˜ ì œëª© | ì´ë¯¸ì§€ ìƒì„± í”„ë¡¬í”„íŠ¸(ì˜ë¬¸) | íŒŒì¼ëª…(ì˜ë¬¸ì†Œë¬¸ì-í•˜ì´í”ˆ.jpg) | ALT í…ìŠ¤íŠ¸(í•œê¸€ 20ì ë‚´ì™¸)
ëŒ€í‘œ ì´ë¯¸ì§€ | ê¸€ ì „ì²´ ëŒ€í‘œ ì¸ë„¤ì¼ | Fresh ${i} on wooden cutting board, natural light, top view, professional food photography, 4k | ${i.toLowerCase().replace(/\s+/g,'-')}-main-thumbnail.jpg | ${i} íš¨ëŠ¥ê³¼ ë¶€ì‘ìš© ëŒ€í‘œ ì´ë¯¸ì§€
ì„¹ì…˜ 1 | ${i}ì´ë€ ë¬´ì—‡ì¸ê°€ìš”? | [êµ¬ì²´ì  ì˜ë¬¸ í”„ë¡¬í”„íŠ¸] | ${i.toLowerCase().replace(/\s+/g,'-')}-origin-history.jpg | ${i} ì›ì‚°ì§€ì™€ ì—­ì‚¬ ì´ë¯¸ì§€
ì„¹ì…˜ 2 | ì˜ì–‘ ì„±ë¶„ê³¼ íš¨ëŠ¥ | [êµ¬ì²´ì  ì˜ë¬¸ í”„ë¡¬í”„íŠ¸] | ${i.toLowerCase().replace(/\s+/g,'-')}-nutrition-benefits.jpg | ${i} ì˜ì–‘ ì„±ë¶„ê³¼ íš¨ëŠ¥ ì´ë¯¸ì§€
ì„¹ì…˜ 3 | ì´ëŸ° ë¶„ë“¤ê»˜ íŠ¹íˆ ì¢‹ì•„ìš” | [êµ¬ì²´ì  ì˜ë¬¸ í”„ë¡¬í”„íŠ¸] | ${i.toLowerCase().replace(/\s+/g,'-')}-recommended-for.jpg | ${i} ì¶”ì²œ ëŒ€ìƒ ì´ë¯¸ì§€
ì„¹ì…˜ 4 | ë¶€ì‘ìš©ê³¼ ì£¼ì˜ì‚¬í•­ | [êµ¬ì²´ì  ì˜ë¬¸ í”„ë¡¬í”„íŠ¸] | ${i.toLowerCase().replace(/\s+/g,'-')}-side-effects-caution.jpg | ${i} ë¶€ì‘ìš© ì£¼ì˜ì‚¬í•­ ì´ë¯¸ì§€
ì„¹ì…˜ 5 | ì œì² ê³¼ ê³ ë¥´ëŠ” ë²•Â·ë³´ê´€ë²• | [êµ¬ì²´ì  ì˜ë¬¸ í”„ë¡¬í”„íŠ¸] | ${i.toLowerCase().replace(/\s+/g,'-')}-how-to-choose-store.jpg | ${i} ê³ ë¥´ëŠ” ë²• ë³´ê´€ë²• ì´ë¯¸ì§€
ì„¹ì…˜ 6 | ë§›ìˆê²Œ ë¨¹ëŠ” ë²•Â·í™œìš© ìš”ë¦¬ | [êµ¬ì²´ì  ì˜ë¬¸ í”„ë¡¬í”„íŠ¸] | ${i.toLowerCase().replace(/\s+/g,'-')}-recipe-cooking.jpg | ${i} ë ˆì‹œí”¼ ìš”ë¦¬ ì´ë¯¸ì§€
ì„¹ì…˜ 7 | êµ¬ì…ì²˜ì™€ ê°€ê²© ì •ë³´ | [êµ¬ì²´ì  ì˜ë¬¸ í”„ë¡¬í”„íŠ¸] | ${i.toLowerCase().replace(/\s+/g,'-')}-where-to-buy.jpg | ${i} êµ¬ì…ì²˜ ê°€ê²© ì´ë¯¸ì§€
ì„¹ì…˜ 8 | ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ | [êµ¬ì²´ì  ì˜ë¬¸ í”„ë¡¬í”„íŠ¸] | ${i.toLowerCase().replace(/\s+/g,'-')}-faq-questions.jpg | ${i} ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ ì´ë¯¸ì§€`;
}

// ============================================================
// COPY HTML
// ============================================================
function copyHTMLStep(stepId) {
  const html = htmlResults[stepId] || '';
  if(!html) { showToast('âš ï¸ ë³µì‚¬í•  HTMLì´ ì—†ì–´ìš”. ë¨¼ì € ìƒì„±í•´ì£¼ì„¸ìš”.'); return; }
  if(navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(html).then(() => showToast('âœ… HTMLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ëì–´ìš”!')).catch(() => copyFallback(html));
  } else copyFallback(html);
}

function copyFallback(text) {
  const ta = document.createElement('textarea');
  ta.value = text;
  ta.style.cssText = 'position:fixed;top:-9999px;left:-9999px;opacity:0';
  document.body.appendChild(ta); ta.focus(); ta.select();
  try { document.execCommand('copy'); showToast('âœ… HTMLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ëì–´ìš”!'); }
  catch(e) { showToast('âŒ ë³µì‚¬ ì‹¤íŒ¨. ì½”ë“œ íƒ­ì—ì„œ ì§ì ‘ ì„ íƒí•´ì£¼ì„¸ìš”.'); }
  document.body.removeChild(ta);
}

// ============================================================
// TOAST
// ============================================================
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  // ëª¨ë°”ì¼ì—ì„œ í•˜ë‹¨ íƒ­ë°” ìœ„ë¡œ
  t.style.bottom = window.innerWidth <= 768 ? '76px' : '28px';
  setTimeout(() => t.classList.remove('show'), 2800);
}

// ============================================================
// MODAL HELPERS
// ============================================================
function openModal(name) { document.getElementById('modal-'+name).classList.add('open'); }
function closeModal(name) { document.getElementById('modal-'+name).classList.remove('open'); }
document.querySelectorAll('.modal-overlay').forEach(el => {
  el.addEventListener('click', e => { if(e.target===el) el.classList.remove('open'); });
});

// ============================================================
// EDIT MODAL
// ============================================================
let editPreviewTimer = null;

function switchEditTab(tab) {
  const codeTab = document.getElementById('edit-tab-code');
  const previewTab = document.getElementById('edit-tab-preview');
  const codeBtn = document.getElementById('edit-tab-code-btn');
  const previewBtn = document.getElementById('edit-tab-preview-btn');
  if(tab === 'code') {
    codeTab.style.display = 'block'; previewTab.style.display = 'none';
    codeBtn.style.background = '#e8f5e9'; codeBtn.style.color = '#2e7d32'; codeBtn.style.fontWeight = '700';
    previewBtn.style.background = 'white'; previewBtn.style.color = 'var(--muted)'; previewBtn.style.fontWeight = '600';
  } else {
    updateEditPreview();
    codeTab.style.display = 'none'; previewTab.style.display = 'block';
    codeBtn.style.background = 'white'; codeBtn.style.color = 'var(--muted)'; codeBtn.style.fontWeight = '600';
    previewBtn.style.background = '#e8f5e9'; previewBtn.style.color = '#2e7d32'; previewBtn.style.fontWeight = '700';
  }
}

function updateEditPreview() {
  const html = document.getElementById('edit-textarea').value;
  const iframe = document.getElementById('edit-preview-iframe');
  if(iframe) writeIframe(iframe, html);
}

function scheduleEditPreview() {
  clearTimeout(editPreviewTimer);
  editPreviewTimer = setTimeout(updateEditPreview, 800);
}

function openEditModal(stepId) {
  if(!htmlResults[stepId]) { showToast('âš ï¸ ë¨¼ì € ì„¹ì…˜ì„ ìƒì„±í•´ì£¼ì„¸ìš”.'); return; }
  currentEditStep = stepId;
  document.getElementById('edit-textarea').value = htmlResults[stepId];
  document.getElementById('edit-ask-input').value = '';
  document.getElementById('edit-ref-text').value = '';
  document.getElementById('edit-ask-result').style.display = 'none';
  document.getElementById('edit-apply-btn').style.display = 'none';
  document.getElementById('edit-loading').style.display = 'none';
  aiEditResult = null;
  switchEditTab('code');
  updateEditPreview();
  openModal('edit');
}

async function askAIEdit() {
  const refText = document.getElementById('edit-ref-text').value.trim();
  const ask = document.getElementById('edit-ask-input').value.trim();
  if(!refText) { showToast('âš ï¸ ì°¸ê³  ê¸€ì„ ë¨¼ì € ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”.'); return; }
  const currentHTML = document.getElementById('edit-textarea').value;
  document.getElementById('edit-loading').style.display = 'flex';
  document.getElementById('edit-ask-result').style.display = 'none';
  document.getElementById('edit-apply-btn').style.display = 'none';
  document.getElementById('edit-ask-btn').disabled = true;
  try {
    const systemExtra = '\n\nì—­í• : ì•„ë˜ [ì°¸ê³  ê¸€]ì˜ ë‚´ìš©ì„ ë°˜ì˜í•˜ì—¬ [ê¸°ì¡´ HTML ì„¹ì…˜]ì„ ë” ì •í™•í•˜ê³  í’ë¶€í•˜ê²Œ ì¬ì‘ì„±í•˜ì„¸ìš”.' +
      '\nê·œì¹™:\n- ì°¸ê³  ê¸€ì˜ ì‚¬ì‹¤ì  ì •ë³´(ìˆ˜ì¹˜, ì„±ë¶„, ë°©ë²• ë“±)ë¥¼ ì„¹ì…˜ì— ìì—°ìŠ¤ëŸ½ê²Œ í†µí•©í•˜ì„¸ìš”' +
      '\n- ê¸°ì¡´ ì„¹ì…˜ì˜ HTML êµ¬ì¡°(íŒë°•ìŠ¤, ê²½ê³ ë°•ìŠ¤, í‘œ ë“±)ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ì„¸ìš”' +
      '\n- ë¸”ë¡œê·¸ íŠ¹ìœ ì˜ ì¹œê·¼í•œ ë§íˆ¬(~ì´ì—ìš”, ~í•´ìš”)ë¥¼ ìœ ì§€í•˜ì„¸ìš”' +
      '\n- ì¶œë ¥ì€ ë°˜ë“œì‹œ ```html ... ``` ë¸”ë¡ìœ¼ë¡œë§Œ í•˜ì„¸ìš”';
    const system = getSystemPrompt() + systemExtra;
    const userParts = [];
    userParts.push('[ì°¸ê³  ê¸€]\n' + refText);
    if(ask) userParts.push('[ì¶”ê°€ ì§€ì‹œì‚¬í•­]\n' + ask);
    userParts.push('[ê¸°ì¡´ HTML ì„¹ì…˜]\n```html\n' + currentHTML + '\n```');
    const rawText = await callClaude(system, userParts.join('\n\n'), 8000);
    const newHTML = extractHTML(rawText);
    aiEditResult = newHTML || rawText;
    const resultEl = document.getElementById('edit-ask-result');
    resultEl.textContent = newHTML ? 'âœ… ì¬ì‘ì„± ì™„ë£Œ! "AI ê²°ê³¼ ì ìš©" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í¸ì§‘ì°½ì— ë°˜ì˜ë¼ìš”.' : rawText;
    resultEl.style.display = 'block';
    document.getElementById('edit-apply-btn').style.display = 'inline-flex';
  } catch(err) {
    document.getElementById('edit-ask-result').textContent = 'âŒ ì˜¤ë¥˜: ' + err.message;
    document.getElementById('edit-ask-result').style.display = 'block';
  }
  document.getElementById('edit-loading').style.display = 'none';
  document.getElementById('edit-ask-btn').disabled = false;
}

function applyAIEdit() {
  if(aiEditResult) {
    document.getElementById('edit-textarea').value = aiEditResult;
    updateEditPreview();
    switchEditTab('preview');
    showToast('âœ… AI ì¬ì‘ì„± ê²°ê³¼ê°€ ì ìš©ëì–´ìš”. ë¯¸ë¦¬ë³´ê¸°ë¥¼ í™•ì¸í•˜ê³  ì €ì¥í•˜ì„¸ìš”!');
  }
}
function saveEdit() {
  if(!currentEditStep) return;
  const newHTML = document.getElementById('edit-textarea').value.trim();
  htmlResults[currentEditStep] = newHTML;
  refreshPreview(currentEditStep);
  closeModal('edit');
  showToast('âœ… ìˆ˜ì • ë‚´ìš©ì´ ì €ì¥ë˜ê³  ë¯¸ë¦¬ë³´ê¸°ì— ë°˜ì˜ëì–´ìš”!');
  saveState();
}

// ============================================================
// POSITION PICKER
// ============================================================
let imgInsertPoints = [], linkInsertPoints = [];
let selectedImgInsertIdx = 0, selectedLinkInsertIdx = 0;
const BLOCK_TAGS = new Set(['div','p','h1','h2','h3','h4','h5','h6','ul','ol','li','table','thead','tbody','tr','blockquote','figure','figcaption','section','article','header','footer','nav']);

function tokenizeHTML(html) {
  const tokens = []; let i = 0;
  while(i < html.length) {
    if(html[i] === '<') {
      if(html.startsWith('<!--', i)) { const end = html.indexOf('-->', i); const e = end>=0?end+3:html.length; tokens.push({type:'comment',text:html.slice(i,e),start:i,end:e}); i=e; continue; }
      const closeM = html.slice(i).match(/^<\/([a-zA-Z][a-zA-Z0-9]*)\s*>/);
      if(closeM) { const end=i+closeM[0].length; tokens.push({type:'close',tag:closeM[1].toLowerCase(),raw:closeM[0],start:i,end}); i=end; continue; }
      const tagM = html.slice(i).match(/^<([a-zA-Z][a-zA-Z0-9]*)([^>]*?)(\/?)>/s);
      if(tagM) { const end=i+tagM[0].length; const tag=tagM[1].toLowerCase(); const selfClose=tagM[3]==='/'||['br','hr','img','input','meta','link'].includes(tag); tokens.push({type:selfClose?'self':'open',tag,raw:tagM[0],start:i,end}); i=end; continue; }
      tokens.push({type:'text',text:'<',start:i,end:i+1}); i++; continue;
    } else { const next=html.indexOf('<',i); const end=next>=0?next:html.length; tokens.push({type:'text',text:html.slice(i,end),start:i,end}); i=end; }
  }
  return tokens;
}

function parseInsertPoints(htmlStr) {
  const points = [{label:'â¬† ì„¹ì…˜ ë§¨ ìœ„',icon:'â¬†',typeLabel:'ìµœìƒë‹¨',preview:'',special:'top',depth:0,charPos:0}];
  const tokens = tokenizeHTML(htmlStr);
  const tagStack = [], insertPoints = [], tagTexts = new Map();
  let stackIdCounter = 0;
  for(let ti=0; ti<tokens.length; ti++) {
    const tok = tokens[ti];
    if(tok.type==='open') { if(BLOCK_TAGS.has(tok.tag)) { const sid=stackIdCounter++; tagStack.push({tag:tok.tag,tokenIdx:ti,depth:tagStack.length,sid}); tagTexts.set(sid,''); } }
    else if(tok.type==='close') {
      for(let si=tagStack.length-1; si>=0; si--) {
        if(tagStack[si].tag===tok.tag) {
          const entry=tagStack.splice(si,1)[0]; const text=(tagTexts.get(entry.sid)||'').replace(/\s+/g,' ').trim().slice(0,50); tagTexts.delete(entry.sid);
          let icon='ğŸ“¦', typeLabel=entry.tag;
          if(entry.tag==='h2'){icon='ğŸ”·';typeLabel='ëŒ€ì œëª©(H2)';}else if(entry.tag==='h3'){icon='ğŸ“Œ';typeLabel='ì†Œì œëª©(H3)';}else if(entry.tag==='p'){icon='ğŸ“';typeLabel='ë¬¸ë‹¨';}else if(entry.tag==='ul'){icon='â€¢';typeLabel='ëª©ë¡';}else if(entry.tag==='table'){icon='ğŸ“Š';typeLabel='í‘œ';}
          insertPoints.push({afterTokenIdx:ti,depth:entry.depth,tag:entry.tag,preview:text,icon,typeLabel,charPos:tok.end}); break;
        }
      }
    } else if(tok.type==='text') { if(tagStack.length>0) { const top=tagStack[tagStack.length-1]; tagTexts.set(top.sid,(tagTexts.get(top.sid)||'')+tok.text); } }
  }
  insertPoints.filter(p=>p.depth<=2&&p.tag!=='li'&&p.tag!=='thead'&&p.tag!=='tbody'&&p.tag!=='tr').forEach(p => points.push({label:'',icon:p.icon,typeLabel:p.typeLabel,preview:p.preview,depth:p.depth,charPos:p.charPos,special:null}));
  points.push({label:'â¬‡ ì„¹ì…˜ ë§¨ ì•„ë˜',icon:'â¬‡',typeLabel:'ìµœí•˜ë‹¨',preview:'',special:'bottom',depth:0,charPos:htmlStr.length});
  return points;
}

function renderPosList(containerId, htmlStr, defaultSelect) {
  const points = parseInsertPoints(htmlStr);
  const container = document.getElementById(containerId);
  if(!container) return points;
  container.innerHTML = points.map((p,i) => {
    const isSpecial = p.special==='top'||p.special==='bottom';
    const indent = (p.depth>0&&!isSpecial) ? `padding-left:${12+p.depth*14}px` : '';
    const sel = defaultSelect>=0 && i===defaultSelect;
    const depthBar = (p.depth>0&&!isSpecial) ? `<span style="display:inline-block;width:2px;height:14px;background:#ccc;margin-right:6px;vertical-align:middle;border-radius:1px;flex-shrink:0"></span>`.repeat(p.depth) : '';
    let labelHTML;
    if(isSpecial) { labelHTML=`<span style="font-size:12px;font-weight:700;color:${sel?'var(--accent)':'var(--ink)'}">${p.icon} ${p.label||p.typeLabel}</span>`; }
    else { const previewTxt=p.preview?`<span style="color:#aaa;font-size:10px;margin-left:5px;font-weight:400;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:160px">${p.preview}</span>`:''; labelHTML=`${depthBar}<span style="font-size:10px;background:${sel?'#1b5e20':'#e8e8e8'};color:${sel?'white':'#444'};padding:1px 6px;border-radius:3px;font-family:monospace;flex-shrink:0;white-space:nowrap">${p.icon} ${p.typeLabel}</span>${previewTxt}`; }
    return `<div class="pos-list-item ${sel?'selected':''}" onclick="selectInsertPoint('${containerId}',${i})" style="padding:6px 12px;${indent};border-bottom:1px solid #f3f0ea;cursor:pointer;display:flex;align-items:center;gap:2px;transition:background .1s;min-height:32px;${sel?'background:#e8f5e9;':''}">${labelHTML}</div>`;
  }).join('');
  return points;
}

function selectInsertPoint(containerId, i) {
  const items = document.querySelectorAll(`#${containerId} .pos-list-item`);
  items.forEach((el,j) => { const sel=j===i; el.classList.toggle('selected',sel); el.style.background=sel?'#e8f5e9':''; });
  const isImg = containerId==='img-pos-list';
  const isSnippet = containerId==='snippet-pos-list';
  const isLink = containerId==='link-pos-list';
  if(isImg) selectedImgInsertIdx=i;
  else if(isSnippet) selectedSnippetInsertIdx=i;
  else selectedLinkInsertIdx=i;
  const ctxId = isImg?'img-pos-context':isSnippet?'snippet-pos-context':'link-pos-context';
  const ctxEl = document.getElementById(ctxId);
  if(!ctxEl) return;
  const points = isImg?imgInsertPoints:isSnippet?snippetInsertPoints:linkInsertPoints;
  const stepId = isImg?currentImageStep:isSnippet?currentSnippetStep:currentLinkStep;
  const html = (stepId&&htmlResults[stepId])||'';
  const p = points[i];
  if(!p||!html) { ctxEl.textContent=''; return; }
  const pos = p.charPos!==undefined?p.charPos:html.length;
  const CTX=140, before=html.slice(Math.max(0,pos-CTX),pos), after=html.slice(pos,Math.min(html.length,pos+CTX));
  function cleanCtx(s){return s.replace(/>\s{2,}</g,'><').replace(/\s+/g,' ').trim();}
  ctxEl.innerHTML=`<span style="color:#aaa">${escHtml(cleanCtx(before).slice(-80))}</span><span style="background:#ff0;color:#333;padding:0 3px;border-radius:2px;font-weight:700"> â† ì—¬ê¸°ì— ì‚½ì… </span><span style="color:#aaa">${escHtml(cleanCtx(after).slice(0,80))}</span>`;
  // ì„¹ì…˜ ì „ì²´ ë¯¸ë¦¬ë³´ê¸° íƒ­ì´ ì—´ë ¤ìˆìœ¼ë©´ ê°±ì‹ 
  if(isImg) {
    const fullEl = document.getElementById('img-prev-full');
    if(fullEl && fullEl.style.display !== 'none') updateImgSectionPreview();
  } else if(isSnippet) {
    const fullEl = document.getElementById('snip-prev-full');
    if(fullEl && fullEl.style.display !== 'none') updateSnippetFullPreview();
  } else if(isLink) {
    const fullEl = document.getElementById('link-prev-full-wrap');
    if(fullEl && fullEl.style.display !== 'none') updateLinkSectionPreview();
  }
}

function insertAtPoint(htmlStr, content, points, idx) {
  const p = points[idx];
  if(!p) return htmlStr+'\n'+content;
  const pos = p.charPos!==undefined?p.charPos:htmlStr.length;
  return htmlStr.slice(0,pos)+'\n'+content+'\n'+htmlStr.slice(pos);
}

// ============================================================
// IMAGE MODAL
// ============================================================
function openImageModal(stepId) {
  if(!htmlResults[stepId]) { showToast('âš ï¸ ë¨¼ì € ì„¹ì…˜ì„ ìƒì„±í•´ì£¼ì„¸ìš”.'); return; }
  currentImageStep = stepId;
  document.getElementById('img-url').value=''; document.getElementById('img-alt').value=''; document.getElementById('img-caption').value='';
  document.getElementById('img-preview').style.display='none'; document.getElementById('img-file').value=''; imgBase64=null; selectedImgInsertIdx=0;
  imgInsertPoints = renderPosList('img-pos-list', htmlResults[stepId], 0);
  const ctx=document.getElementById('img-pos-context'); if(ctx) ctx.textContent='ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ìš”ì†Œ ì „í›„ ì½”ë“œê°€ í‘œì‹œë¼ìš”';
  // ë¯¸ë¦¬ë³´ê¸° ì´ˆê¸°í™”
  const simpleEl = document.getElementById('img-prev-simple');
  if(simpleEl) { simpleEl.style.padding='16px'; simpleEl.style.background='#fafafa'; simpleEl.style.display='flex'; simpleEl.innerHTML='<span style="font-size:11.5px;color:var(--muted)">ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ ë‚˜íƒ€ë‚˜ìš”</span>'; }
  const fullEl = document.getElementById('img-prev-full');
  if(fullEl) fullEl.style.display='none';
  const simpleBtn = document.getElementById('img-prev-tab-simple');
  const fullBtn = document.getElementById('img-prev-tab-full');
  if(simpleBtn) { simpleBtn.style.background='#2e7d32'; simpleBtn.style.color='white'; }
  if(fullBtn) { fullBtn.style.background='white'; fullBtn.style.color='var(--muted)'; }
  openModal('image');
}

function imgFileChange(e) {
  const file=e.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=ev=>{imgBase64=ev.target.result;const prev=document.getElementById('img-preview');prev.src=imgBase64;prev.style.display='block';document.getElementById('img-url').value='';updateImgInsertPreview();};
  reader.readAsDataURL(file);
}
function imgDragOver(e){e.preventDefault();document.getElementById('img-drop').classList.add('drag-over');}
function imgDrop(e){e.preventDefault();document.getElementById('img-drop').classList.remove('drag-over');const file=e.dataTransfer.files[0];if(file&&file.type.startsWith('image/'))imgFileChange({target:{files:[file]}});}
function imgUrlPreview(){const url=document.getElementById('img-url').value.trim();const prev=document.getElementById('img-preview');if(url){prev.src=url;prev.style.display='block';imgBase64=null;}else prev.style.display='none';updateImgInsertPreview();}

function switchImgPreviewTab(tab) {
  const simpleEl = document.getElementById('img-prev-simple');
  const fullEl = document.getElementById('img-prev-full');
  const simpleBtn = document.getElementById('img-prev-tab-simple');
  const fullBtn = document.getElementById('img-prev-tab-full');
  if(tab === 'simple') {
    simpleEl.style.display = 'flex'; fullEl.style.display = 'none';
    simpleBtn.style.background = '#2e7d32'; simpleBtn.style.color = 'white';
    fullBtn.style.background = 'white'; fullBtn.style.color = 'var(--muted)';
  } else {
    simpleEl.style.display = 'none'; fullEl.style.display = 'block';
    fullBtn.style.background = '#2e7d32'; fullBtn.style.color = 'white';
    simpleBtn.style.background = 'white'; simpleBtn.style.color = 'var(--muted)';
    updateImgSectionPreview();
  }
}

function updateImgSectionPreview() {
  const iframe = document.getElementById('img-section-preview-iframe');
  if(!iframe || !currentImageStep) return;
  const src = imgBase64 || document.getElementById('img-url').value.trim();
  if(!src) { writeIframe(iframe, htmlResults[currentImageStep]||''); return; }
  const alt = document.getElementById('img-alt').value.trim() || 'ì´ë¯¸ì§€';
  const caption = document.getElementById('img-caption').value.trim();
  const align = document.getElementById('img-align').value;
  const width = document.getElementById('img-width').value;
  const textAlign = align === 'left' ? 'left' : align === 'right' ? 'right' : 'center';
  const imgHTML = `<div style="text-align:${textAlign};margin:20px 0;"><img src="${src}" alt="${alt}" style="max-width:${width};height:auto;border-radius:8px;box-shadow:0 2px 12px rgba(0,0,0,0.1)" />${caption?`<div style="font-size:13px;color:#888;margin-top:8px;font-style:italic">${caption}</div>`:''}</div>`;
  const previewHtml = insertAtPoint(htmlResults[currentImageStep]||'', imgHTML, imgInsertPoints, selectedImgInsertIdx);
  writeIframe(iframe, previewHtml);
}

function updateImgInsertPreview() {
  const previewEl = document.getElementById('img-prev-simple');
  if(!previewEl) return;
  const src = imgBase64 || document.getElementById('img-url').value.trim();
  if(!src) {
    previewEl.style.padding = '16px';
    previewEl.innerHTML = '<span style="font-size:11.5px;color:var(--muted)">ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ ë‚˜íƒ€ë‚˜ìš”</span>';
    return;
  }
  const alt = document.getElementById('img-alt').value.trim() || 'ì´ë¯¸ì§€';
  const caption = document.getElementById('img-caption').value.trim();
  const align = document.getElementById('img-align').value;
  const width = document.getElementById('img-width').value;
  const textAlign = align === 'left' ? 'left' : align === 'right' ? 'right' : 'center';
  previewEl.style.padding = '12px';
  previewEl.style.background = '#fff';
  previewEl.innerHTML = '<div style="text-align:' + textAlign + '">' +
    '<img src="' + src + '" alt="' + alt + '" style="max-width:' + width + ';height:auto;border-radius:8px;box-shadow:0 2px 12px rgba(0,0,0,0.1)" />' +
    (caption ? '<div style="font-size:12px;color:#888;margin-top:6px;font-style:italic">' + caption + '</div>' : '') +
    '</div>';
  // ì„¹ì…˜ ì „ì²´ íƒ­ì´ ì—´ë ¤ìˆìœ¼ë©´ ê°™ì´ ì—…ë°ì´íŠ¸
  const fullEl = document.getElementById('img-prev-full');
  if(fullEl && fullEl.style.display !== 'none') updateImgSectionPreview();
}

function insertImage() {
  const src=imgBase64||document.getElementById('img-url').value.trim();
  if(!src){showToast('âš ï¸ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ê±°ë‚˜ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
  const alt=document.getElementById('img-alt').value.trim()||'ì´ë¯¸ì§€';
  const caption=document.getElementById('img-caption').value.trim();
  const align=document.getElementById('img-align').value;
  const width=document.getElementById('img-width').value;
  const textAlign=align==='left'?'left':align==='right'?'right':'center';
  const imgHTML=`<div style="text-align:${textAlign};margin:20px 0;"><img src="${src}" alt="${alt}" style="max-width:${width};height:auto;border-radius:8px;box-shadow:0 2px 12px rgba(0,0,0,0.1)" />${caption?`<div style="font-size:13px;color:#888;margin-top:8px;font-style:italic">${caption}</div>`:''}</div>`;
  htmlResults[currentImageStep]=insertAtPoint(htmlResults[currentImageStep]||'',imgHTML,imgInsertPoints,selectedImgInsertIdx);
  refreshPreview(currentImageStep); closeModal('image'); showToast('âœ… ì´ë¯¸ì§€ê°€ ì‚½ì…ëì–´ìš”!');
}

// ============================================================
// LINK MODAL
// ============================================================
const LINK_STYLES = [
  {id:'solid',name:'â–¶ ì±„ìš´ ë²„íŠ¼',desc:'ê¸°ë³¸ ì†”ë¦¬ë“œ'},
  {id:'outline',name:'â–· ì•„ì›ƒë¼ì¸',desc:'í…Œë‘ë¦¬ë§Œ'},
  {id:'pill',name:'â—‰ ë‘¥ê·¼ í•„',desc:'ì•Œì•½í˜• ë²„íŠ¼'},
  {id:'ghost',name:'â—‹ ê³ ìŠ¤íŠ¸',desc:'ë°˜íˆ¬ëª… ë°°ê²½'},
  {id:'text',name:'â€” í…ìŠ¤íŠ¸í˜•',desc:'ë§í¬ ìŠ¤íƒ€ì¼'},
  {id:'banner',name:'â–¦ ë°°ë„ˆí˜•',desc:'ì¢Œìš° ë¶„ë¦¬'},
  {id:'card',name:'â–£ ì¹´ë“œí˜•',desc:'ê·¸ë¦¼ì ì¹´ë“œ'},
  {id:'arrow',name:'â†’ í™”ì‚´í‘œí˜•',desc:'ìš°ì¸¡ í™”ì‚´í‘œ'},
];

function initLinkStyleGrid() {
  const grid=document.getElementById('link-style-grid');
  if(!grid) return;
  grid.innerHTML=LINK_STYLES.map((s,i)=>`<div class="pos-opt ${i===0?'selected':''}" id="lstyle-${s.id}" onclick="selectLinkStyle('${s.id}')" style="padding:7px 6px;font-size:11px;line-height:1.3"><div style="font-weight:700">${s.name}</div><div style="font-size:9.5px;color:var(--muted)">${s.desc}</div></div>`).join('');
}

function selectLinkStyle(id) {
  selectedLinkStyle=id;
  LINK_STYLES.forEach(s=>{ const el=document.getElementById('lstyle-'+s.id); if(el) el.classList.toggle('selected',s.id===id); });
  updateLinkPreview();
}

function openLinkModal(stepId) {
  if(!htmlResults[stepId]){showToast('âš ï¸ ë¨¼ì € ì„¹ì…˜ì„ ìƒì„±í•´ì£¼ì„¸ìš”.');return;}
  currentLinkStep=stepId;
  document.getElementById('link-url').value=''; document.getElementById('link-text').value='';
  selectedLinkInsertIdx=0;
  linkInsertPoints=renderPosList('link-pos-list',htmlResults[stepId],0);
  initLinkStyleGrid(); selectedLinkStyle='solid';
  const preview=document.getElementById('link-preview');
  if(preview) preview.innerHTML='<span style="font-size:11px;color:var(--muted)">í…ìŠ¤íŠ¸ì™€ URLì„ ì…ë ¥í•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ ë‚˜íƒ€ë‚˜ìš”</span>';
  // íƒ­ ì´ˆê¸°í™”
  const simpleWrap=document.getElementById('link-prev-simple-wrap');
  const fullWrap=document.getElementById('link-prev-full-wrap');
  const simpleBtn=document.getElementById('link-prev-tab-simple');
  const fullBtn=document.getElementById('link-prev-tab-full');
  if(simpleWrap) simpleWrap.style.display='block';
  if(fullWrap) fullWrap.style.display='none';
  if(simpleBtn){simpleBtn.style.background='#1565c0';simpleBtn.style.color='white';}
  if(fullBtn){fullBtn.style.background='white';fullBtn.style.color='var(--muted)';}
  openModal('link');
}

function quickLink(text,url){document.getElementById('link-text').value=text;document.getElementById('link-url').value=url;updateLinkPreview();}
function addLinkIcon(icon){const el=document.getElementById('link-text');el.value=icon+' '+el.value;updateLinkPreview();}

function updateLinkPreview() {
  const text=document.getElementById('link-text').value.trim();
  const url=document.getElementById('link-url').value.trim();
  const previewEl=document.getElementById('link-preview');
  if(previewEl) {
    if(!text&&!url){previewEl.innerHTML='<span style="font-size:11px;color:var(--muted)">í…ìŠ¤íŠ¸ì™€ URLì„ ì…ë ¥í•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ ë‚˜íƒ€ë‚˜ìš”</span>';}
    else { const mc=(config.colorNum&&COLORS[config.colorNum])?COLORS[config.colorNum].main:'#2e7d32'; previewEl.innerHTML=buildLinkHTML(text||'ë§í¬ í…ìŠ¤íŠ¸',url||'#',selectedLinkStyle,'_blank'); }
  }
  // ì„¹ì…˜ ì „ì²´ íƒ­ì´ ì—´ë ¤ìˆìœ¼ë©´ ê°±ì‹ 
  const fullEl = document.getElementById('link-prev-full-wrap');
  if(fullEl && fullEl.style.display !== 'none') updateLinkSectionPreview();
}

function buildLinkHTML(text,url,style,target) {
  const mc=(config.colorNum&&COLORS[config.colorNum])?COLORS[config.colorNum].main:'#2e7d32';
  const t=target||'_blank';
  function center(h){return `<div style="margin:16px 0;text-align:center">${h}</div>`;}
  switch(style){
    case 'solid': return center(`<a href="${url}" target="${t}" style="display:inline-block;background:${mc};color:white;padding:11px 28px;border-radius:8px;text-decoration:none;font-weight:700;font-size:14px;font-family:'Noto Sans KR',sans-serif">${text}</a>`);
    case 'outline': return center(`<a href="${url}" target="${t}" style="display:inline-block;background:white;color:${mc};padding:10px 26px;border-radius:8px;text-decoration:none;font-weight:700;font-size:14px;border:2px solid ${mc};font-family:'Noto Sans KR',sans-serif">${text}</a>`);
    case 'pill': return center(`<a href="${url}" target="${t}" style="display:inline-block;background:${mc};color:white;padding:10px 30px;border-radius:50px;text-decoration:none;font-weight:700;font-size:14px;font-family:'Noto Sans KR',sans-serif">${text}</a>`);
    case 'ghost': return center(`<a href="${url}" target="${t}" style="display:inline-block;background:${mc}18;color:${mc};padding:10px 26px;border-radius:8px;text-decoration:none;font-weight:700;font-size:14px;border:1.5px solid ${mc}50;font-family:'Noto Sans KR',sans-serif">${text}</a>`);
    case 'text': return center(`<a href="${url}" target="${t}" style="color:${mc};font-size:14px;font-weight:600;font-family:'Noto Sans KR',sans-serif;text-decoration:none">${text} â†’</a>`);
    case 'banner': return `<div style="background:${mc}12;border:1px solid ${mc}35;border-radius:10px;padding:14px 20px;margin:16px 0;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px"><span style="font-size:14px;font-weight:600;color:#333;font-family:'Noto Sans KR',sans-serif">${text}</span><a href="${url}" target="${t}" style="background:${mc};color:white;padding:8px 18px;border-radius:7px;text-decoration:none;font-size:13px;font-weight:700;font-family:'Noto Sans KR',sans-serif;white-space:nowrap">ë°”ë¡œê°€ê¸° â†’</a></div>`;
    case 'card': return center(`<a href="${url}" target="${t}" style="display:inline-block;background:white;border:1.5px solid ${mc}40;color:${mc};padding:12px 30px;border-radius:10px;text-decoration:none;font-weight:700;font-size:14px;box-shadow:0 4px 14px ${mc}20;font-family:'Noto Sans KR',sans-serif">${text}</a>`);
    case 'arrow': return `<div style="margin:16px 0;text-align:center"><a href="${url}" target="${t}" style="display:inline-flex;align-items:center;gap:8px;background:${mc};color:white;padding:11px 24px;border-radius:8px;text-decoration:none;font-weight:700;font-size:14px;font-family:'Noto Sans KR',sans-serif">${text}<span style="font-size:18px;line-height:1">â†’</span></a></div>`;
    default: return center(`<a href="${url}" target="${t}">${text}</a>`);
  }
}

function insertLink() {
  const text=document.getElementById('link-text').value.trim();
  const url=document.getElementById('link-url').value.trim();
  if(!text){showToast('âš ï¸ ë§í¬ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
  if(!url){showToast('âš ï¸ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
  const target=document.getElementById('link-target').value;
  const linkHTML=buildLinkHTML(text,url,selectedLinkStyle,target);
  htmlResults[currentLinkStep]=insertAtPoint(htmlResults[currentLinkStep]||'',linkHTML,linkInsertPoints,selectedLinkInsertIdx);
  refreshPreview(currentLinkStep); closeModal('link'); showToast('âœ… ë§í¬ê°€ ì‚½ì…ëì–´ìš”!');
}

// ============================================================
// LINK SECTION PREVIEW
// ============================================================
let currentLinkPreviewTab = 'simple';

function switchLinkPreviewTab(tab) {
  currentLinkPreviewTab = tab;
  const simpleWrap = document.getElementById('link-prev-simple-wrap');
  const fullWrap = document.getElementById('link-prev-full-wrap');
  const simpleBtn = document.getElementById('link-prev-tab-simple');
  const fullBtn = document.getElementById('link-prev-tab-full');
  if(tab === 'simple') {
    simpleWrap.style.display = 'block'; fullWrap.style.display = 'none';
    simpleBtn.style.background = '#1565c0'; simpleBtn.style.color = 'white';
    fullBtn.style.background = 'white'; fullBtn.style.color = 'var(--muted)';
  } else {
    simpleWrap.style.display = 'none'; fullWrap.style.display = 'block';
    fullBtn.style.background = '#1565c0'; fullBtn.style.color = 'white';
    simpleBtn.style.background = 'white'; simpleBtn.style.color = 'var(--muted)';
    updateLinkSectionPreview();
  }
}

function updateLinkSectionPreview() {
  const iframe = document.getElementById('link-section-preview-iframe');
  if(!iframe || !currentLinkStep) return;
  const text = document.getElementById('link-text').value.trim();
  const url = document.getElementById('link-url').value.trim();
  if(!text && !url) { writeIframe(iframe, htmlResults[currentLinkStep]||''); return; }
  const target = document.getElementById('link-target').value;
  const linkHTML = buildLinkHTML(text||'ë§í¬ í…ìŠ¤íŠ¸', url||'#', selectedLinkStyle, target);
  const previewHtml = insertAtPoint(htmlResults[currentLinkStep]||'', linkHTML, linkInsertPoints, selectedLinkInsertIdx);
  writeIframe(iframe, previewHtml);
}

// ============================================================
// HTML SNIPPET INSERT
// ============================================================
let currentSnippetStep = null;
let snippetInsertPoints = [];
let selectedSnippetInsertIdx = 0;

const SNIPPET_TEMPLATES = {
  tip: `<div style="background:#e8f5e9;border-left:4px solid #2e7d32;padding:14px 16px;border-radius:0 8px 8px 0;margin:16px 0;font-family:'Noto Sans KR',sans-serif">
  <strong style="color:#1b5e20;font-size:14px">ğŸ’¡ ì•Œì•„ë‘ë©´ ì¢‹ì•„ìš”</strong>
  <p style="margin:6px 0 0;color:#2e7d32;font-size:14px;line-height:1.6">ì—¬ê¸°ì— íŒ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.</p>
</div>`,
  warn: `<div style="background:#fff8e1;border-left:4px solid #f9a825;padding:14px 16px;border-radius:0 8px 8px 0;margin:16px 0;font-family:'Noto Sans KR',sans-serif">
  <strong style="color:#e65100;font-size:14px">âš ï¸ ì£¼ì˜ì‚¬í•­</strong>
  <p style="margin:6px 0 0;color:#bf360c;font-size:14px;line-height:1.6">ì—¬ê¸°ì— ì£¼ì˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.</p>
</div>`,
  product: `<div style="border:1.5px solid #e0e0e0;border-radius:12px;padding:16px 20px;margin:16px 0;display:flex;align-items:center;gap:16px;background:white;font-family:'Noto Sans KR',sans-serif;box-shadow:0 2px 8px rgba(0,0,0,0.06)">
  <div style="font-size:40px">ğŸ›’</div>
  <div style="flex:1">
    <div style="font-size:16px;font-weight:700;color:#222;margin-bottom:4px">ì œí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”</div>
    <div style="font-size:13px;color:#666;margin-bottom:8px">ì œí’ˆ ì„¤ëª…ì„ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”.</div>
    <a href="https://example.com" target="_blank" style="display:inline-block;background:#2e7d32;color:white;padding:7px 18px;border-radius:6px;text-decoration:none;font-size:13px;font-weight:700">êµ¬ë§¤í•˜ê¸° â†’</a>
  </div>
</div>`,
  divider: `<hr style="border:none;border-top:2px dashed #e0e0e0;margin:28px 0;" />`,
  notice: `<div style="background:#e3f2fd;border:1px solid #90caf9;border-radius:10px;padding:14px 20px;margin:16px 0;display:flex;align-items:center;gap:12px;font-family:'Noto Sans KR',sans-serif">
  <span style="font-size:24px">ğŸ“¢</span>
  <div>
    <div style="font-size:14px;font-weight:700;color:#1565c0;margin-bottom:2px">ê³µì§€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”</div>
    <div style="font-size:13px;color:#1976d2;line-height:1.5">ê³µì§€ ë‚´ìš©ì„ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”.</div>
  </div>
</div>`,
  table2: `<table style="width:100%;border-collapse:collapse;margin:16px 0;font-family:'Noto Sans KR',sans-serif;font-size:14px">
  <thead>
    <tr style="background:#2e7d32;color:white">
      <th style="padding:10px 14px;text-align:left;border:1px solid #1b5e20">í•­ëª©</th>
      <th style="padding:10px 14px;text-align:left;border:1px solid #1b5e20">ë‚´ìš©</th>
    </tr>
  </thead>
  <tbody>
    <tr style="background:white"><td style="padding:9px 14px;border:1px solid #e0e0e0">í•­ëª© 1</td><td style="padding:9px 14px;border:1px solid #e0e0e0">ë‚´ìš© 1</td></tr>
    <tr style="background:#f9f9f9"><td style="padding:9px 14px;border:1px solid #e0e0e0">í•­ëª© 2</td><td style="padding:9px 14px;border:1px solid #e0e0e0">ë‚´ìš© 2</td></tr>
    <tr style="background:white"><td style="padding:9px 14px;border:1px solid #e0e0e0">í•­ëª© 3</td><td style="padding:9px 14px;border:1px solid #e0e0e0">ë‚´ìš© 3</td></tr>
  </tbody>
</table>`
};

function applySnippetTemplate(key) {
  const code = SNIPPET_TEMPLATES[key];
  if(!code) return;
  document.getElementById('snippet-code').value = code;
  updateSnippetPreview();
}

function openSnippetModal(stepId) {
  if(!htmlResults[stepId]) { showToast('âš ï¸ ë¨¼ì € ì„¹ì…˜ì„ ìƒì„±í•´ì£¼ì„¸ìš”.'); return; }
  currentSnippetStep = stepId;
  document.getElementById('snippet-code').value = '';
  selectedSnippetInsertIdx = 0;
  snippetInsertPoints = renderPosList('snippet-pos-list', htmlResults[stepId], 0);
  const ctx = document.getElementById('snippet-pos-context');
  if(ctx) ctx.textContent = 'ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ìš”ì†Œ ì „í›„ ì½”ë“œê°€ í‘œì‹œë¼ìš”';
  // ë¯¸ë¦¬ë³´ê¸° ì´ˆê¸°í™”
  const codeIframe = document.getElementById('snip-code-iframe');
  if(codeIframe) codeIframe.srcdoc = '<html><body style="display:flex;align-items:center;justify-content:center;height:90%;color:#aaa;font-family:sans-serif;font-size:13px">ì½”ë“œë¥¼ ì…ë ¥í•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ ë‚˜íƒ€ë‚˜ìš”</body></html>';
  const fullIframe = document.getElementById('snip-full-iframe');
  if(fullIframe) writeIframe(fullIframe, htmlResults[stepId]||'');
  // íƒ­ ì´ˆê¸°í™”
  switchSnipPreviewTab('code');
  openModal('htmlsnippet');
}

function switchSnipPreviewTab(tab) {
  const codeEl = document.getElementById('snip-prev-code');
  const fullEl = document.getElementById('snip-prev-full');
  const codeBtn = document.getElementById('snip-prev-tab-code');
  const fullBtn = document.getElementById('snip-prev-tab-full');
  if(tab === 'code') {
    codeEl.style.display = 'block'; fullEl.style.display = 'none';
    codeBtn.style.background = '#2e7d32'; codeBtn.style.color = 'white';
    fullBtn.style.background = 'white'; fullBtn.style.color = 'var(--muted)';
  } else {
    codeEl.style.display = 'none'; fullEl.style.display = 'block';
    fullBtn.style.background = '#2e7d32'; fullBtn.style.color = 'white';
    codeBtn.style.background = 'white'; codeBtn.style.color = 'var(--muted)';
    updateSnippetFullPreview();
  }
}

function updateSnippetPreview() {
  const code = document.getElementById('snippet-code').value;
  const iframe = document.getElementById('snip-code-iframe');
  if(iframe) writeIframe(iframe, code || '');
  // ì„¹ì…˜ ì „ì²´ íƒ­ì´ ì—´ë ¤ìˆìœ¼ë©´ ê°™ì´ ê°±ì‹ 
  const fullEl = document.getElementById('snip-prev-full');
  if(fullEl && fullEl.style.display !== 'none') updateSnippetFullPreview();
}

function updateSnippetFullPreview() {
  const iframe = document.getElementById('snip-full-iframe');
  if(!iframe || !currentSnippetStep) return;
  const code = document.getElementById('snippet-code').value;
  if(!code.trim()) { writeIframe(iframe, htmlResults[currentSnippetStep]||''); return; }
  const previewHtml = insertAtPoint(htmlResults[currentSnippetStep]||'', code, snippetInsertPoints, selectedSnippetInsertIdx);
  writeIframe(iframe, previewHtml);
}

function insertSnippet() {
  const code = document.getElementById('snippet-code').value.trim();
  if(!code) { showToast('âš ï¸ ì‚½ì…í•  HTML ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  htmlResults[currentSnippetStep] = insertAtPoint(htmlResults[currentSnippetStep]||'', code, snippetInsertPoints, selectedSnippetInsertIdx);
  refreshPreview(currentSnippetStep);
  closeModal('htmlsnippet');
  showToast('âœ… HTML ì½”ë“œê°€ ì‚½ì…ëì–´ìš”!');
}


// ============================================================
// SIDEBAR DONE MARK
// ============================================================
function markSidebarDone(stepId) {
  const btn=document.getElementById('sb-'+stepId); if(btn) btn.classList.add('done');
  updateCompileChecklist();
}

// ============================================================
// COMPILE
// ============================================================
function updateCompileChecklist() {
  const el=document.getElementById('compile-checklist'); if(!el) return;
  el.innerHTML=STEPS.map(s=>`<div class="compile-item ${htmlResults[s.id]?'done':'missing'}"><span class="compile-label">${s.emoji} ${s.title}</span><span class="compile-status">${htmlResults[s.id]?'âœ… ì™„ë£Œ':'â³ ë¯¸ì™„ì„±'}</span></div>`).join('');
}

function compileAll() {
  updateCompileChecklist();
  const parts=STEPS.map(s=>htmlResults[s.id]||'').filter(Boolean);
  if(!parts.length){document.getElementById('compile-result').innerHTML='<div class="alert alert-error">ìƒì„±ëœ ì„¹ì…˜ì´ ì—†ì–´ìš”. STEP 1ë¶€í„° ìˆœì„œëŒ€ë¡œ ìƒì„±í•´ì£¼ì„¸ìš”.</div>';return;}
  const fullHtml=`<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>${config.ingredient} íš¨ëŠ¥ê³¼ ë¶€ì‘ìš© ì™„ë²½ ì •ë¦¬</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>body{margin:0;padding:20px;background:#fafafa}</style>
</head>
<body>
${parts.join('\n\n')}
</body>
</html>`;
  htmlResults['_full']=fullHtml;
  document.getElementById('compile-result').innerHTML=`
    <div class="alert alert-success" style="margin-bottom:12px">ğŸ‰ ì´ ${parts.length}ê°œ ì„¹ì…˜ì´ í•©ì³ì¡Œì–´ìš”!</div>
    <div class="result-box">
      <div class="result-header">
        <div class="result-title">${config.ingredient} ì™„ì„± ë¸”ë¡œê·¸</div>
        <div style="display:flex;gap:6px">
          <button class="btn btn-sm" style="background:#f5f5f5;border:1px solid var(--border)" onclick="copyFull()">ğŸ“‹ ì „ì²´ ë³µì‚¬</button>
          <button class="btn btn-primary btn-sm" onclick="downloadAll()">â¬‡ï¸ íŒŒì¼ ì €ì¥</button>
        </div>
      </div>
      <div class="result-content">
        <iframe id="compile-preview-iframe" class="preview-frame" style="height:680px"></iframe>
      </div>
    </div>`;
  // srcdocì„ JSë¡œ ì§ì ‘ ì„¤ì • (ì†ì„± ì¸ì½”ë”© ë¬¸ì œ ë°©ì§€)
  const compileIframe = document.getElementById('compile-preview-iframe');
  if(compileIframe) compileIframe.srcdoc = fullHtml;
}

function copyFull(){const html=htmlResults['_full']||'';if(!html){showToast('âš ï¸ ë¨¼ì € "ì „ì²´ HTML í•©ì¹˜ê¸°"ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.');return;}if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(html).then(()=>showToast('âœ… ì „ì²´ HTML ë³µì‚¬ ì™„ë£Œ!')).catch(()=>copyFallback(html));else copyFallback(html);}

function downloadAll(){
  if(!htmlResults['_full']){compileAll();setTimeout(downloadAll,600);return;}
  const blob=new Blob([htmlResults['_full']],{type:'text/html;charset=utf-8'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=`${config.ingredient||'blog'}-ë¸”ë¡œê·¸.html`;a.click();
}

// ============================================================
// UTILS
// ============================================================
function esc4attr(str){return str.replace(/"/g,'&quot;').replace(/'/g,'&#39;');}
function escHtml(str){return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

// ============================================================
// PERSIST STATE (localStorage)
// ============================================================
const STORAGE_KEY = 'blog_gen_state_v1';

function saveState() {
  try {
    const state = {
      config,
      selectedColor,
      results,
      htmlResults,
      extraResults
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  } catch(e) { /* ì €ì¥ ì‹¤íŒ¨ ë¬´ì‹œ */ }
}

function loadState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return false;
    const state = JSON.parse(raw);
    if(!state.config || !state.config.ingredient) return false;

    config = state.config;
    selectedColor = state.selectedColor || 2;
    results = state.results || {};
    htmlResults = state.htmlResults || {};
    extraResults = state.extraResults || {};
    return true;
  } catch(e) { return false; }
}

function restoreUI() {
  // ì„¤ì • ì…ë ¥ê°’ ë³µì›
  if(config.geminiKey) document.getElementById('gemini-api-key').value = config.geminiKey;
  if(config.ingredient) document.getElementById('ingredient').value = config.ingredient;
  if(config.keyword) document.getElementById('keyword').value = config.keyword;
  selectColor(selectedColor);

  // ìŠ¤í… info bar / desc ë³µì›
  STEPS.forEach(s => {
    const info = document.getElementById('info-'+s.id);
    const desc = document.getElementById('desc-'+s.id);
    if(info) { info.innerHTML=`ğŸ“Œ ì¬ë£Œëª…: <strong>${config.ingredient}</strong> &nbsp;|&nbsp; ğŸ”‘ í‚¤ì›Œë“œ: <strong>${config.keyword}</strong> &nbsp;|&nbsp; ğŸ¨ ì»¬ëŸ¬: <strong>${COLORS[selectedColor].name}</strong>`; info.style.display='block'; }
    if(desc) desc.textContent=`${config.ingredient}ì— ëŒ€í•œ ${s.title} ì„¹ì…˜ì„ AIë¡œ ìƒì„±í•´ìš”.`;
  });

  // ê° ìŠ¤í… ê²°ê³¼ ë³µì›
  STEPS.forEach(s => {
    if(htmlResults[s.id]) {
      renderResult(s.id, results[s.id]||'', htmlResults[s.id]);
      markSidebarDone(s.id);
    }
  });

  // ë¶€ê°€ ì •ë³´ ë³µì›
  if(extraResults['step9']) renderExtraInfoPanel();

  showToast('âœ… ì´ì „ ì‘ì—… ë‚´ìš©ì„ ë¶ˆëŸ¬ì™”ì–´ìš”!');
}

function clearState() {
  if(!confirm('ì €ì¥ëœ ì‘ì—… ë‚´ìš©ì„ ëª¨ë‘ ì‚­ì œí•˜ê³  ì²˜ìŒë¶€í„° ì‹œì‘í• ê¹Œìš”?')) return;
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
}

// ============================================================
// INIT
// ============================================================
initStepPanels();
updateCompileChecklist();

// ì €ì¥ëœ ìƒíƒœ ë³µì›
if(loadState()) {
  restoreUI();
  updateCompileChecklist();
}
</script>
</body>
</html>
